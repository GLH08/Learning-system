# 📚 智能答题学习系统 - 完整项目计划书

## 目录

**第1部分**
1. [项目概述](#1-项目概述)
2. [功能需求](#2-功能需求)

**第2部分**
3. 技术架构
4. 数据库设计

**第3部分**
5. API接口设计

**第4部分**
6. 前端页面设计
7. AI模块设计
8. 文档解析模块

**第5部分**
9. 部署方案
10. 开发计划
11. 附录

---

## 1. 项目概述

### 1.1 项目背景

为改变学习新知识的枯燥过程，通过答题系统学习、巩固知识，即通过随机组卷答题不断强化知识点。系统支持导入现有题库（可能仅包含题目），借助AI自动补全答案与解析，实现高效的学习闭环。

### 1.2 项目目标

| 目标 | 描述 |
|------|------|
| 🎯 核心目标 | 通过答题强化知识点，AI辅助完善题库 |
| 👤 使用者 | 个人使用，单管理员模式 |
| 📱 平台 | Web端（响应式设计，支持PC和移动端） |
| 🚀 部署 | Docker容器化，服务器 `IP:端口` 访问，域名反代在宿主机配置 |

### 1.3 核心特性

```
┌─────────────────────────────────────────────────────────────────┐
│                      🌟 核心特性                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  📥 智能导入          支持Word/Excel/TXT等格式，自动解析题目结构  │
│                       兼容仅题干、题干+答案、完整格式等多种形式   │
│                                                                  │
│  🤖 AI补全            接入OpenAI兼容API，自动生成答案与解析      │
│                       支持批量处理，管理员可控启停               │
│                                                                  │
│  📝 智能组卷          按题型/数量/难度/知识点自由组合            │
│                       多种答题模式：考试/练习/背题               │
│                                                                  │
│  📊 学习分析          自动评分，错题收集                         │
│                       AI生成个性化错题分析报告                   │
│                                                                  │
│  💾 数据管理          题库导入导出，数据备份恢复                  │
│                       SQLite轻量存储，Docker容器化部署           │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 1.4 系统边界

```
┌─────────────────────────────────────────────────────────────────┐
│                          系统边界                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ✅ 系统包含                          ❌ 系统不包含              │
│  ─────────────────                    ─────────────────          │
│  • 题库管理（CRUD）                   • 多用户注册登录            │
│  • 多格式文档导入                     • 用户权限分级              │
│  • AI答案解析生成                     • 在线协作功能              │
│  • 智能组卷答题                       • 移动端原生APP             │
│  • 自动评分统计                       • 付费/积分系统             │
│  • 错题本管理                         • 社区讨论功能              │
│  • 学习数据分析                       • SSL证书配置（宿主机处理） │
│  • AI学习报告                         • 域名反代（宿主机处理）    │
│  • 数据备份恢复                                                  │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 2. 功能需求

### 2.1 功能架构图

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          智能答题学习系统                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐ │
│  │   题库管理    │  │   组卷答题    │  │   学习追踪    │  │   系统设置   │ │
│  ├──────────────┤  ├──────────────┤  ├──────────────┤  ├──────────────┤ │
│  │ • 分类管理    │  │ • 快速组卷    │  │ • 错题本      │  │ • AI配置     │ │
│  │ • 题目浏览    │  │ • 自定义组卷  │  │ • 答题历史    │  │ • 密码管理   │ │
│  │ • 题目搜索    │  │ • 考试模式    │  │ • 学习统计    │  │ • 数据备份   │ │
│  │ • 单题添加    │  │ • 练习模式    │  │ • AI分析报告  │  │ • 数据恢复   │ │
│  │ • 批量导入    │  │ • 背题模式    │  │              │  │              │ │
│  │ • 批量导出    │  │ • 自动评分    │  │              │  │              │ │
│  │ • AI批量补全  │  │ • 答案解析    │  │              │  │              │ │
│  │ • 补全任务控制│  │              │  │              │  │              │ │
│  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘ │
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │                          🤖 AI 服务层                               │ │
│  ├────────────────────────────────────────────────────────────────────┤ │
│  │  答案生成  │  解析生成  │  知识点解释  │  错题分析报告  │  追问对话  │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 2.2 功能清单

#### 2.2.1 认证模块

| 功能ID | 功能名称 | 描述 | 优先级 |
|--------|---------|------|--------|
| AUTH-01 | 管理员登录 | 密码保护访问，JWT Token认证 | P0 |
| AUTH-02 | 会话管理 | 登录状态保持，自动续期 | P0 |
| AUTH-03 | 密码修改 | 支持修改管理员密码 | P1 |

#### 2.2.2 题库管理模块

| 功能ID | 功能名称 | 描述 | 优先级 |
|--------|---------|------|--------|
| QB-01 | 分类管理 | 树形分类结构，增删改查 | P0 |
| QB-02 | 题目列表 | 分页展示，支持多条件筛选 | P0 |
| QB-03 | 题目搜索 | 关键词搜索题干内容 | P0 |
| QB-04 | 题目筛选 | 按分类/题型/难度/状态筛选 | P0 |
| QB-05 | 单题添加 | 手动添加单个题目 | P0 |
| QB-06 | 题目编辑 | 修改题目内容、答案、解析等 | P0 |
| QB-07 | 题目删除 | 单个/批量删除题目 | P0 |
| QB-08 | 批量导入 | 支持Word/Excel/TXT/JSON格式 | P0 |
| QB-09 | 批量导出 | 导出为Excel/JSON/Markdown格式 | P0 |
| QB-10 | AI单题补全 | 为单个题目生成答案/解析 | P0 |
| QB-11 | AI批量补全 | 批量生成答案解析，后台任务 | P0 |
| QB-12 | 补全任务控制 | 启动/暂停/终止批量补全任务 | P0 |
| QB-13 | 补全结果确认 | 审核AI生成内容，确认入库 | P0 |

#### 2.2.3 组卷答题模块

| 功能ID | 功能名称 | 描述 | 优先级 |
|--------|---------|------|--------|
| EXAM-01 | 快速组卷 | 一键随机生成试卷 | P0 |
| EXAM-02 | 自定义组卷 | 设置题型/数量/难度/分值/范围 | P0 |
| EXAM-03 | 考试模式 | 计时答题，交卷后显示结果 | P0 |
| EXAM-04 | 练习模式 | 即时显示答案解析 | P0 |
| EXAM-05 | 背题模式 | 直接展示题目+答案+解析 | P1 |
| EXAM-06 | 自动评分 | 客观题自动评分 | P0 |
| EXAM-07 | 答案解析 | 展示正确答案和解析 | P0 |
| EXAM-08 | 实时AI获取 | 题目无答案时实时调用AI | P0 |

#### 2.2.4 学习追踪模块

| 功能ID | 功能名称 | 描述 | 优先级 |
|--------|---------|------|--------|
| LEARN-01 | 错题本 | 自动收集错题 | P0 |
| LEARN-02 | 错题重做 | 针对错题重新练习 | P0 |
| LEARN-03 | 错题移除 | 标记已掌握，移出错题本 | P1 |
| LEARN-04 | 答题历史 | 查看历史答题记录 | P0 |
| LEARN-05 | 学习统计 | 答题数/正确率/学习时长统计 | P1 |
| LEARN-06 | AI分析报告 | 基于错题生成学习建议 | P0 |

#### 2.2.5 系统设置模块

| 功能ID | 功能名称 | 描述 | 优先级 |
|--------|---------|------|--------|
| SYS-01 | AI配置 | API地址/密钥/模型设置 | P0 |
| SYS-02 | 密码管理 | 修改管理员密码 | P1 |
| SYS-03 | 数据备份 | 导出数据库备份文件 | P1 |
| SYS-04 | 数据恢复 | 从备份文件恢复数据 | P1 |

### 2.3 题目类型定义

系统支持四种题目类型：

```
┌─────────────────────────────────────────────────────────────────┐
│                         题目类型                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  📌 单选题 (single)                                              │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │ 中华人民共和国成立是哪一年？（  ）                          ││
│  │ A. 1945                                                      ││
│  │ B. 1948                                                      ││
│  │ C. 1949  ✓                                                   ││
│  │ D. 1950                                                      ││
│  │ 答案：C                                                      ││
│  │ 解析：1949年10月1日，毛泽东在天安门城楼...                   ││
│  └─────────────────────────────────────────────────────────────┘│
│                                                                  │
│  📌 多选题 (multiple)                                            │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │ 以下哪些是中国四大发明？（  ）                               ││
│  │ A. 造纸术  ✓                                                 ││
│  │ B. 蒸汽机                                                    ││
│  │ C. 印刷术  ✓                                                 ││
│  │ D. 指南针  ✓                                                 ││
│  │ 答案：ACD                                                    ││
│  │ 解析：中国四大发明是造纸术、印刷术、火药、指南针...          ││
│  └─────────────────────────────────────────────────────────────┘│
│                                                                  │
│  📌 判断题 (judge)                                               │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │ 中华人民共和国成立于1949年。（  ）                          ││
│  │ 答案：正确  ✓                                                ││
│  │ 解析：1949年10月1日，中华人民共和国正式成立...               ││
│  └─────────────────────────────────────────────────────────────┘│
│                                                                  │
│  📌 简述题 (essay)                                               │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │ 请简要描述中华人民共和国成立的历史意义。                     ││
│  │ 答案：中华人民共和国的成立标志着...                          ││
│  │ 解析：可从以下几个方面分析：1.民族独立 2.人民解放...         ││
│  └─────────────────────────────────────────────────────────────┘│
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 2.4 题目状态流转

题目导入后通常不完整，需要通过AI逐步补全：

```
┌────────────────────────────────────────────────────────────────────────┐
│                           题目状态流转图                                │
├────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│                         ┌─────────────┐                                │
│                         │   导入题目   │                                │
│                         └──────┬──────┘                                │
│                                │                                        │
│              ┌─────────────────┼─────────────────┐                     │
│              │                 │                 │                      │
│              ▼                 ▼                 ▼                      │
│      ┌──────────────┐  ┌──────────────┐  ┌──────────────┐              │
│      │   仅题干      │  │ 题干+答案    │  │  完整题目     │              │
│      │              │  │  (无解析)     │  │              │              │
│      │ answer:none  │  │ answer:      │  │ answer:      │              │
│      │ explain:none │  │  confirmed   │  │  confirmed   │              │
│      └──────┬───────┘  │ explain:none │  │ explain:     │              │
│             │          └──────┬───────┘  │  confirmed   │              │
│             │                 │          └──────────────┘              │
│             │                 │                 ▲                       │
│             │                 │                 │                       │
│             ▼                 ▼                 │                       │
│      ┌─────────────────────────────────────────┴───┐                   │
│      │              点击 "AI补全"                    │                   │
│      └─────────────────────────────────────────────┘                   │
│                                │                                        │
│                                ▼                                        │
│                     ┌──────────────────┐                               │
│                     │   AI生成中...     │                               │
│                     │  (ai_pending)     │                               │
│                     └────────┬─────────┘                               │
│                              │                                          │
│                              ▼                                          │
│                     ┌──────────────────┐                               │
│                     │   AI已生成       │                               │
│                     │ (ai_generated)   │                               │
│                     └────────┬─────────┘                               │
│                              │                                          │
│            ┌─────────────────┼─────────────────┐                       │
│            │                 │                 │                        │
│            ▼                 ▼                 ▼                        │
│     ┌────────────┐   ┌────────────┐   ┌────────────┐                   │
│     │  确认采纳   │   │  编辑修改   │   │  重新生成   │                   │
│     └─────┬──────┘   └─────┬──────┘   └─────┬──────┘                   │
│           │                │                 │                          │
│           ▼                ▼                 │                          │
│     ┌──────────────────────────┐             │                          │
│     │        已确认            │◀────────────┘                          │
│     │     (confirmed)         │                                         │
│     │   正式纳入题库           │                                         │
│     └──────────────────────────┘                                        │
│                                                                         │
└────────────────────────────────────────────────────────────────────────┘
```

### 2.5 用例图

```
┌─────────────────────────────────────────────────────────────────────────┐
│                              用例图                                      │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│                              ┌─────────┐                                │
│                              │ 管理员   │                                │
│                              └────┬────┘                                │
│                                   │                                      │
│       ┌───────────────────────────┼───────────────────────────┐         │
│       │                           │                           │          │
│       ▼                           ▼                           ▼          │
│  ┌─────────┐               ┌─────────────┐              ┌─────────┐     │
│  │题库管理 │               │  组卷答题    │              │学习追踪 │     │
│  └────┬────┘               └──────┬──────┘              └────┬────┘     │
│       │                           │                          │          │
│  ┌────┴────────────┐        ┌─────┴─────┐           ┌────────┴───────┐ │
│  │                 │        │           │           │                │  │
│  ▼                 ▼        ▼           ▼           ▼                ▼  │
│ ┌───┐ ┌───┐ ┌───┐ ┌───┐  ┌───┐ ┌───┐ ┌───┐     ┌───┐ ┌───┐ ┌───┐    │
│ │分 │ │添 │ │导 │ │AI │  │快 │ │自 │ │查 │     │查 │ │重 │ │查 │    │
│ │类 │ │加 │ │入 │ │补 │  │速 │ │定 │ │看 │     │看 │ │做 │ │看 │    │
│ │管 │ │题 │ │导 │ │全 │  │组 │ │义 │ │结 │     │错 │ │错 │ │统 │    │
│ │理 │ │目 │ │出 │ │任 │  │卷 │ │组 │ │果 │     │题 │ │题 │ │计 │    │
│ │  │ │  │ │  │ │务 │  │  │ │卷 │ │  │     │本 │ │  │ │  │    │
│ └───┘ └───┘ └───┘ └───┘  └───┘ └───┘ └───┘     └───┘ └───┘ └───┘    │
│                                                                          │
│  ┌─────────┐                                                            │
│  │系统设置 │                                                            │
│  └────┬────┘                                                            │
│       │                                                                  │
│  ┌────┴────────────────┐                                                │
│  │          │          │                                                 │
│  ▼          ▼          ▼                                                 │
│ ┌───┐    ┌───┐    ┌───┐                                                 │
│ │AI │    │修 │    │数 │                                                 │
│ │配 │    │改 │    │据 │                                                 │
│ │置 │    │密 │    │备 │                                                 │
│ │  │    │码 │    │份 │                                                 │
│ └───┘    └───┘    └───┘                                                 │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```


## 3. 技术架构

### 3.1 整体架构图

```
┌─────────────────────────────────────────────────────────────────────────┐
│                              用户浏览器                                  │
│                      (PC / 平板 / 手机浏览器)                            │
└─────────────────────────────────┬───────────────────────────────────────┘
                                  │ HTTP (IP:Port)
                                  │
                                  │ ┌─────────────────────────────────┐
                                  │ │  可选：宿主机Nginx反代+域名+SSL  │
                                  │ └─────────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         Docker Compose 容器组                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│    ┌─────────────────────────────────────────────────────────────┐      │
│    │                    Frontend Container                        │      │
│    │                      (端口: 5173)                            │      │
│    │  ┌─────────────────────────────────────────────────────┐    │      │
│    │  │                    Vue 3 应用                        │    │      │
│    │  │  ┌───────────┐ ┌───────────┐ ┌───────────────────┐  │    │      │
│    │  │  │   Vite    │ │ Tailwind  │ │     Naive UI      │  │    │      │
│    │  │  │  构建工具  │ │    CSS    │ │     组件库        │  │    │      │
│    │  │  └───────────┘ └───────────┘ └───────────────────┘  │    │      │
│    │  │  ┌───────────┐ ┌───────────┐ ┌───────────────────┐  │    │      │
│    │  │  │   Pinia   │ │Vue Router │ │      Axios        │  │    │      │
│    │  │  │  状态管理  │ │   路由    │ │    HTTP客户端     │  │    │      │
│    │  │  └───────────┘ └───────────┘ └───────────────────┘  │    │      │
│    │  └─────────────────────────────────────────────────────┘    │      │
│    └───────────────────────────────┬─────────────────────────────┘      │
│                                    │ /api                               │
│                                    ▼                                    │
│    ┌─────────────────────────────────────────────────────────────┐      │
│    │                    Backend Container                         │      │
│    │                      (端口: 8000)                            │      │
│    │  ┌─────────────────────────────────────────────────────┐    │      │
│    │  │                   FastAPI 应用                       │    │      │
│    │  │                                                      │    │      │
│    │  │  ┌─────────────────────────────────────────────┐    │    │      │
│    │  │  │                 API 路由层                   │    │    │      │
│    │  │  │  auth │ questions │ exams │ ai │ settings   │    │    │      │
│    │  │  └─────────────────────┬───────────────────────┘    │    │      │
│    │  │                        │                             │    │      │
│    │  │  ┌─────────────────────▼───────────────────────┐    │    │      │
│    │  │  │                业务服务层                    │    │    │      │
│    │  │  │  ┌──────────┐ ┌──────────┐ ┌──────────┐    │    │    │      │
│    │  │  │  │ AI服务   │ │文档解析  │ │ 任务管理  │    │    │    │      │
│    │  │  │  │          │ │          │ │          │    │    │    │      │
│    │  │  │  └──────────┘ └──────────┘ └──────────┘    │    │    │      │
│    │  │  └─────────────────────┬───────────────────────┘    │    │      │
│    │  │                        │                             │    │      │
│    │  │  ┌─────────────────────▼───────────────────────┐    │    │      │
│    │  │  │              数据访问层 (SQLAlchemy)         │    │    │      │
│    │  │  └─────────────────────┬───────────────────────┘    │    │      │
│    │  │                        │                             │    │      │
│    │  └────────────────────────┼─────────────────────────────┘    │      │
│    │                           │                                  │      │
│    │                           ▼                                  │      │
│    │                    ┌─────────────┐                           │      │
│    │                    │   SQLite    │                           │      │
│    │                    │  Database   │                           │      │
│    │                    │ (data目录)   │                           │      │
│    │                    └─────────────┘                           │      │
│    └─────────────────────────────────────────────────────────────┘      │
│                                                                          │
│    数据卷挂载:                                                           │
│    ├── ./data:/app/data         (数据库文件)                            │
│    └── ./backup:/app/backup     (备份文件)                              │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
                                  │
                                  │ HTTPS (外部API调用)
                                  ▼
                    ┌──────────────────────────────┐
                    │    OpenAI Compatible API      │
                    │  ┌────────────────────────┐  │
                    │  │ OpenAI / DeepSeek /    │  │
                    │  │ Claude / 本地部署模型   │  │
                    │  └────────────────────────┘  │
                    └──────────────────────────────┘
```

### 3.2 技术栈选型

| 层级 | 技术选型 | 版本 | 选型理由 |
|------|----------|------|----------|
| **前端框架** | Vue 3 | 3.4+ | 响应式、组合式API、生态成熟 |
| **构建工具** | Vite | 5.0+ | 快速冷启动、HMR热更新 |
| **UI框架** | Naive UI | 2.38+ | 美观现代、Vue3原生支持、组件丰富 |
| **CSS框架** | Tailwind CSS | 3.4+ | 原子化CSS、高度可定制 |
| **状态管理** | Pinia | 2.1+ | Vue官方推荐、轻量直观 |
| **路由** | Vue Router | 4.2+ | Vue官方路由 |
| **HTTP客户端** | Axios | 1.6+ | 成熟稳定、拦截器机制 |
| **Markdown渲染** | markdown-it | 14.0+ | 渲染题目解析、扩展性强 |
| **图表** | ECharts | 5.5+ | 学习统计图表展示 |
| **后端框架** | FastAPI | 0.109+ | 高性能、自动文档、类型安全 |
| **ORM** | SQLAlchemy | 2.0+ | 成熟稳定、支持异步 |
| **数据库** | SQLite | 3.40+ | 轻量、单文件、易备份 |
| **数据验证** | Pydantic | 2.6+ | 数据校验、序列化 |
| **AI客户端** | OpenAI SDK | 1.12+ | OpenAI兼容接口 |
| **文档解析** | python-docx | 1.1+ | Word文档解析 |
| **Excel处理** | openpyxl | 3.1+ | Excel读写 |
| **JWT认证** | python-jose | 3.3+ | Token生成验证 |
| **密码哈希** | passlib | 1.7+ | 安全密码处理 |
| **部署** | Docker Compose | 2.24+ | 容器编排 |

### 3.3 目录结构

```
quiz-learning-system/
│
├── docker-compose.yml              # Docker编排配置
├── .env.example                    # 环境变量示例
├── .env                            # 环境变量（不提交git）
├── .gitignore
├── README.md                       # 项目说明文档
│
├── backend/                        # 后端项目
│   ├── Dockerfile
│   ├── requirements.txt
│   ├── main.py                     # 应用入口
│   ├── config.py                   # 配置管理
│   │
│   ├── api/                        # API路由
│   │   ├── __init__.py
│   │   ├── router.py               # 路由汇总
│   │   ├── auth.py                 # 认证接口
│   │   ├── categories.py           # 分类接口
│   │   ├── questions.py            # 题目接口
│   │   ├── exams.py                # 考试接口
│   │   ├── wrong_questions.py      # 错题接口
│   │   ├── stats.py                # 统计接口
│   │   ├── ai.py                   # AI接口
│   │   └── settings.py             # 设置接口
│   │
│   ├── models/                     # 数据模型
│   │   ├── __init__.py
│   │   ├── database.py             # 数据库连接
│   │   ├── category.py
│   │   ├── question.py
│   │   ├── exam.py
│   │   ├── wrong_question.py
│   │   ├── ai_task.py
│   │   ├── learning_stat.py
│   │   └── setting.py
│   │
│   ├── schemas/                    # Pydantic模型
│   │   ├── __init__.py
│   │   ├── auth.py
│   │   ├── category.py
│   │   ├── question.py
│   │   ├── exam.py
│   │   ├── ai.py
│   │   └── common.py
│   │
│   ├── services/                   # 业务服务
│   │   ├── __init__.py
│   │   ├── auth_service.py         # 认证服务
│   │   ├── ai_service.py           # AI调用服务
│   │   ├── document_parser.py      # 文档解析服务
│   │   ├── exam_service.py         # 组卷评分服务
│   │   ├── export_service.py       # 导出服务
│   │   └── task_manager.py         # 后台任务管理
│   │
│   ├── utils/                      # 工具函数
│   │   ├── __init__.py
│   │   ├── security.py             # 安全相关（JWT、密码）
│   │   ├── helpers.py              # 辅助函数
│   │   └── exceptions.py           # 自定义异常
│   │
│   └── tests/                      # 测试文件
│       ├── __init__.py
│       ├── test_questions.py
│       └── test_exams.py
│
├── frontend/                       # 前端项目
│   ├── Dockerfile
│   ├── package.json
│   ├── pnpm-lock.yaml
│   ├── vite.config.ts
│   ├── tailwind.config.js
│   ├── postcss.config.js
│   ├── tsconfig.json
│   ├── index.html
│   │
│   ├── public/
│   │   ├── favicon.ico
│   │   └── logo.svg
│   │
│   └── src/
│       ├── main.ts                 # 应用入口
│       ├── App.vue                 # 根组件
│       ├── env.d.ts                # 类型声明
│       │
│       ├── api/                    # API调用封装
│       │   ├── index.ts            # Axios实例配置
│       │   ├── auth.ts
│       │   ├── categories.ts
│       │   ├── questions.ts
│       │   ├── exams.ts
│       │   ├── wrongQuestions.ts
│       │   ├── ai.ts
│       │   ├── stats.ts
│       │   └── settings.ts
│       │
│       ├── components/             # 公共组件
│       │   ├── common/
│       │   │   ├── AppHeader.vue
│       │   │   ├── AppSidebar.vue
│       │   │   ├── AppFooter.vue
│       │   │   ├── LoadingSpinner.vue
│       │   │   ├── EmptyState.vue
│       │   │   ├── ConfirmModal.vue
│       │   │   └── Pagination.vue
│       │   │
│       │   ├── question/
│       │   │   ├── QuestionCard.vue
│       │   │   ├── QuestionForm.vue
│       │   │   ├── QuestionFilter.vue
│       │   │   ├── QuestionImport.vue
│       │   │   ├── QuestionExport.vue
│       │   │   ├── AICompleteModal.vue
│       │   │   ├── AITaskProgress.vue
│       │   │   └── OptionEditor.vue
│       │   │
│       │   ├── exam/
│       │   │   ├── ExamConfigForm.vue
│       │   │   ├── ExamPaper.vue
│       │   │   ├── ExamTimer.vue
│       │   │   ├── ExamResult.vue
│       │   │   ├── AnswerSheet.vue
│       │   │   ├── QuestionDisplay.vue
│       │   │   └── AIReportModal.vue
│       │   │
│       │   ├── category/
│       │   │   ├── CategoryTree.vue
│       │   │   ├── CategoryForm.vue
│       │   │   └── CategorySelect.vue
│       │   │
│       │   └── stats/
│       │       ├── StatsOverview.vue
│       │       ├── DailyChart.vue
│       │       └── WeakPointsList.vue
│       │
│       ├── views/                  # 页面视图
│       │   ├── Login.vue
│       │   ├── Dashboard.vue
│       │   │
│       │   ├── questions/
│       │   │   ├── QuestionList.vue
│       │   │   ├── QuestionDetail.vue
│       │   │   ├── QuestionCreate.vue
│       │   │   ├── QuestionEdit.vue
│       │   │   └── CategoryManage.vue
│       │   │
│       │   ├── exam/
│       │   │   ├── ExamCreate.vue
│       │   │   ├── ExamTaking.vue
│       │   │   ├── ExamResult.vue
│       │   │   └── ExamHistory.vue
│       │   │
│       │   ├── learning/
│       │   │   ├── WrongQuestions.vue
│       │   │   └── Statistics.vue
│       │   │
│       │   └── settings/
│       │       └── Settings.vue
│       │
│       ├── stores/                 # Pinia状态管理
│       │   ├── index.ts
│       │   ├── user.ts             # 用户/认证状态
│       │   ├── question.ts         # 题目状态
│       │   ├── exam.ts             # 考试状态
│       │   └── app.ts              # 全局应用状态
│       │
│       ├── router/                 # 路由配置
│       │   └── index.ts
│       │
│       ├── composables/            # 组合式函数
│       │   ├── useAuth.ts
│       │   ├── useMessage.ts
│       │   └── useLoading.ts
│       │
│       ├── types/                  # TypeScript类型
│       │   ├── question.ts
│       │   ├── exam.ts
│       │   ├── category.ts
│       │   └── api.ts
│       │
│       ├── styles/                 # 全局样式
│       │   ├── main.css
│       │   └── variables.css
│       │
│       └── utils/                  # 工具函数
│           ├── request.ts          # 请求封装
│           ├── storage.ts          # 本地存储
│           ├── format.ts           # 格式化
│           └── validators.ts       # 验证函数
│
├── data/                           # 数据持久化目录
│   ├── .gitkeep
│   └── quiz.db                     # SQLite数据库（运行时生成）
│
└── backup/                         # 备份目录
    └── .gitkeep
```

### 3.4 容器通信架构

```
┌─────────────────────────────────────────────────────────────────────┐
│                      Docker Compose Network                          │
│                        (quiz-network)                                │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│   ┌─────────────────────┐         ┌─────────────────────┐           │
│   │  frontend           │         │  backend            │           │
│   │  ─────────────────  │         │  ─────────────────  │           │
│   │  Image: node:20     │         │  Image: python:3.11 │           │
│   │  Port: 5173:5173    │  ────▶  │  Port: 8000:8000    │           │
│   │                     │  /api   │                     │           │
│   │  Vite Dev Server    │         │  Uvicorn Server     │           │
│   │  (开发模式)          │         │                     │           │
│   │                     │         │                     │           │
│   │  Nginx              │         │  Volume:            │           │
│   │  (生产模式)          │         │  - ./data:/app/data │           │
│   │                     │         │  - ./backup:/app/   │           │
│   │                     │         │    backup           │           │
│   └─────────────────────┘         └─────────────────────┘           │
│             │                               │                        │
│             │                               │                        │
│             ▼                               ▼                        │
│   ┌─────────────────────────────────────────────────────────────┐   │
│   │                     Host Port Mapping                        │   │
│   │  ┌───────────────────┐    ┌───────────────────┐             │   │
│   │  │ 0.0.0.0:5173      │    │ 0.0.0.0:8000      │             │   │
│   │  │ 前端访问入口       │    │ API直接访问(可选) │             │   │
│   │  └───────────────────┘    └───────────────────┘             │   │
│   └─────────────────────────────────────────────────────────────┘   │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
                                  │
                                  │ 用户访问
                                  ▼
                    ┌──────────────────────────────┐
                    │    http://服务器IP:5173       │
                    │                              │
                    │  或通过宿主机Nginx反代:        │
                    │    https://your-domain.com   │
                    └──────────────────────────────┘
```

---

## 4. 数据库设计

### 4.1 ER图

```
┌─────────────────────────────────────────────────────────────────────────┐
│                              ER 关系图                                   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌─────────────────┐                 ┌─────────────────────────────────┐│
│  │   categories    │                 │           questions              ││
│  ├─────────────────┤                 ├─────────────────────────────────┤│
│  │ id (PK)         │◀─────┐          │ id (PK)                         ││
│  │ name            │      │          │ category_id (FK) ───────────────┘│
│  │ parent_id (FK)──┼──────┘          │ type                            ││
│  │ description     │                 │ difficulty                      ││
│  │ sort_order      │                 │ content                         ││
│  │ created_at      │                 │ options                         ││
│  │ updated_at      │                 │ answer                          ││
│  └─────────────────┘                 │ answer_status                   ││
│         │                            │ explanation                     ││
│         │ 1:N                        │ explanation_status              ││
│         │                            │ tags                            ││
│         ▼                            │ source                          ││
│  ┌─────────────────┐                 │ created_at                      ││
│  │   (子分类)       │                 │ updated_at                      ││
│  └─────────────────┘                 └───────────────┬─────────────────┘│
│                                                      │                   │
│                                              ┌───────┴───────┐          │
│                                              │               │          │
│                                              ▼               ▼          │
│  ┌─────────────────────────────┐   ┌─────────────────────────────────┐ │
│  │          exams              │   │       wrong_questions           │ │
│  ├─────────────────────────────┤   ├─────────────────────────────────┤ │
│  │ id (PK)                     │   │ id (PK)                         │ │
│  │ title                       │   │ question_id (FK) ───────────────┘ │
│  │ config                      │   │ exam_id (FK) ─────────────────────┤
│  │ question_ids                │   │ user_answer                     │ │
│  │ question_snapshots          │   │ wrong_count                     │ │
│  │ answers                     │   │ is_mastered                     │ │
│  │ score                       │   │ created_at                      │ │
│  │ total_score                 │   │ last_wrong_at                   │ │
│  │ correct_count               │   └─────────────────────────────────┘ │
│  │ wrong_count                 │                                       │
│  │ time_spent                  │   ┌─────────────────────────────────┐ │
│  │ status                      │   │         ai_tasks                │ │
│  │ ai_report                   │   ├─────────────────────────────────┤ │
│  │ created_at                  │   │ id (PK)                         │ │
│  │ started_at                  │   │ type                            │ │
│  │ completed_at                │   │ status                          │ │
│  └─────────────────────────────┘   │ question_ids                    │ │
│                                     │ total_count                     │ │
│                                     │ completed_count                 │ │
│  ┌─────────────────────────────┐   │ failed_count                    │ │
│  │      learning_stats         │   │ error_message                   │ │
│  ├─────────────────────────────┤   │ created_at                      │ │
│  │ id (PK)                     │   │ updated_at                      │ │
│  │ date (UNIQUE)               │   └─────────────────────────────────┘ │
│  │ questions_done              │                                       │
│  │ correct_count               │   ┌─────────────────────────────────┐ │
│  │ wrong_count                 │   │          settings               │ │
│  │ study_time                  │   ├─────────────────────────────────┤ │
│  │ exams_count                 │   │ key (PK)                        │ │
│  │ created_at                  │   │ value                           │ │
│  │ updated_at                  │   │ description                     │ │
│  └─────────────────────────────┘   │ updated_at                      │ │
│                                     └─────────────────────────────────┘ │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 4.2 表结构详细设计

#### 4.2.1 分类表 (categories)

```sql
-- 分类表：支持树形结构
CREATE TABLE categories (
    id TEXT PRIMARY KEY,                          -- UUID
    name TEXT NOT NULL,                           -- 分类名称
    parent_id TEXT,                               -- 父分类ID，顶级分类为NULL
    description TEXT,                             -- 分类描述
    sort_order INTEGER DEFAULT 0,                 -- 排序顺序（同级内排序）
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (parent_id) REFERENCES categories(id) ON DELETE SET NULL
);

-- 索引
CREATE INDEX idx_categories_parent ON categories(parent_id);
CREATE INDEX idx_categories_sort ON categories(sort_order);
```

**字段说明：**

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| id | TEXT | 是 | 主键，UUID格式 |
| name | TEXT | 是 | 分类名称，如"计算机网络"、"数据结构" |
| parent_id | TEXT | 否 | 父分类ID，顶级分类为NULL |
| description | TEXT | 否 | 分类描述 |
| sort_order | INTEGER | 否 | 同级分类间的排序，默认0 |

#### 4.2.2 题目表 (questions)

```sql
-- 题目表：核心表
CREATE TABLE questions (
    id TEXT PRIMARY KEY,                          -- UUID
    category_id TEXT,                             -- 所属分类ID
    
    -- 题目基本信息
    type TEXT NOT NULL,                           -- 题型: single/multiple/judge/essay
    difficulty TEXT DEFAULT 'medium',             -- 难度: easy/medium/hard
    content TEXT NOT NULL,                        -- 题干内容（支持Markdown）
    options TEXT,                                 -- JSON: 选项 {"A":"xxx","B":"xxx",...}
    
    -- 答案与解析（支持逐步补全）
    answer TEXT,                                  -- 答案
    answer_status TEXT DEFAULT 'none',            -- none/ai_pending/ai_generated/confirmed
    explanation TEXT,                             -- 解析
    explanation_status TEXT DEFAULT 'none',       -- none/ai_pending/ai_generated/confirmed
    
    -- 元数据
    tags TEXT,                                    -- JSON: 标签 ["标签1","标签2"]
    source TEXT,                                  -- 题目来源
    
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE SET NULL,
    CHECK (type IN ('single', 'multiple', 'judge', 'essay')),
    CHECK (difficulty IN ('easy', 'medium', 'hard')),
    CHECK (answer_status IN ('none', 'ai_pending', 'ai_generated', 'confirmed')),
    CHECK (explanation_status IN ('none', 'ai_pending', 'ai_generated', 'confirmed'))
);

-- 索引
CREATE INDEX idx_questions_category ON questions(category_id);
CREATE INDEX idx_questions_type ON questions(type);
CREATE INDEX idx_questions_difficulty ON questions(difficulty);
CREATE INDEX idx_questions_answer_status ON questions(answer_status);
CREATE INDEX idx_questions_explanation_status ON questions(explanation_status);
CREATE INDEX idx_questions_created ON questions(created_at);

-- 全文搜索索引（SQLite FTS5）
CREATE VIRTUAL TABLE questions_fts USING fts5(
    content,
    content=questions,
    content_rowid=rowid
);

-- 触发器：保持FTS索引同步
CREATE TRIGGER questions_ai AFTER INSERT ON questions BEGIN
    INSERT INTO questions_fts(rowid, content) VALUES (NEW.rowid, NEW.content);
END;

CREATE TRIGGER questions_ad AFTER DELETE ON questions BEGIN
    INSERT INTO questions_fts(questions_fts, rowid, content) VALUES('delete', OLD.rowid, OLD.content);
END;

CREATE TRIGGER questions_au AFTER UPDATE ON questions BEGIN
    INSERT INTO questions_fts(questions_fts, rowid, content) VALUES('delete', OLD.rowid, OLD.content);
    INSERT INTO questions_fts(rowid, content) VALUES (NEW.rowid, NEW.content);
END;
```

**字段说明：**

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| id | TEXT | 是 | 主键，UUID格式 |
| category_id | TEXT | 否 | 所属分类，可为空（未分类） |
| type | TEXT | 是 | 题型：single单选/multiple多选/judge判断/essay简述 |
| difficulty | TEXT | 否 | 难度：easy简单/medium中等/hard困难，默认medium |
| content | TEXT | 是 | 题干内容，支持Markdown格式 |
| options | TEXT | 否 | JSON格式选项，判断题和简述题可为空 |
| answer | TEXT | 否 | 答案，可后期补全 |
| answer_status | TEXT | 否 | 答案状态：none无/ai_pending生成中/ai_generated已生成待确认/confirmed已确认 |
| explanation | TEXT | 否 | 解析，可后期补全 |
| explanation_status | TEXT | 否 | 解析状态，同answer_status |
| tags | TEXT | 否 | JSON格式标签数组 |
| source | TEXT | 否 | 题目来源，如"2024年期末考试" |

**options字段格式示例：**

```json
// 单选题/多选题
{
    "A": "1945年",
    "B": "1948年",
    "C": "1949年",
    "D": "1950年"
}

// 判断题：无需options，answer为"正确"或"错误"

// 简述题：无需options
```

**status字段状态说明：**

| 状态值 | 说明 |
|--------|------|
| none | 无内容（导入时未提供） |
| ai_pending | AI正在生成中 |
| ai_generated | AI已生成，待管理员确认 |
| confirmed | 已确认，正式可用 |

#### 4.2.3 考试记录表 (exams)

```sql
-- 考试/试卷记录表
CREATE TABLE exams (
    id TEXT PRIMARY KEY,                          -- UUID
    title TEXT,                                   -- 试卷标题
    
    -- 组卷配置（JSON）
    config TEXT,
    /* config结构:
    {
        "mode": "exam",                           -- exam考试/practice练习/review背题
        "timeLimit": 60,                          -- 时间限制(分钟)，0不限时
        "questionConfig": [
            {"type": "single", "count": 20, "score": 2, "difficulty": "mixed"},
            {"type": "multiple", "count": 10, "score": 3},
            {"type": "judge", "count": 10, "score": 1}
        ],
        "categoryIds": ["cat1", "cat2"],          -- 限定分类，空数组表示全部
        "shuffleOptions": true                    -- 是否打乱选项顺序
    }
    */
    
    -- 试卷内容
    question_ids TEXT,                            -- JSON: 题目ID列表 ["id1","id2",...]
    question_snapshots TEXT,                      -- JSON: 题目快照（保存当时的题目内容）
    
    -- 答题数据
    answers TEXT,                                 -- JSON: 用户答案 {"q_id":"answer",...}
    
    -- 评分结果
    score REAL,                                   -- 得分
    total_score REAL,                             -- 总分
    correct_count INTEGER DEFAULT 0,              -- 正确题数
    wrong_count INTEGER DEFAULT 0,                -- 错误题数
    
    -- 答题时间
    time_spent INTEGER DEFAULT 0,                 -- 用时(秒)
    
    -- 状态
    status TEXT DEFAULT 'ongoing',                -- ongoing进行中/completed已完成/abandoned已放弃
    
    -- AI分析报告
    ai_report TEXT,                               -- Markdown格式的AI分析报告
    
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    started_at DATETIME,                          -- 开始答题时间
    completed_at DATETIME,                        -- 完成时间
    
    CHECK (status IN ('ongoing', 'completed', 'abandoned'))
);

-- 索引
CREATE INDEX idx_exams_status ON exams(status);
CREATE INDEX idx_exams_created ON exams(created_at DESC);
```

**question_snapshots字段说明：**

保存组卷时题目的完整快照，防止后续题目修改影响历史记录的正确性：

```json
[
    {
        "id": "question-uuid-1",
        "type": "single",
        "content": "中华人民共和国成立是哪一年？",
        "options": {"A":"1945","B":"1948","C":"1949","D":"1950"},
        "answer": "C",
        "explanation": "1949年10月1日...",
        "score": 2
    }
]
```

#### 4.2.4 错题本表 (wrong_questions)

```sql
-- 错题本表
CREATE TABLE wrong_questions (
    id TEXT PRIMARY KEY,                          -- UUID
    question_id TEXT NOT NULL,                    -- 题目ID
    exam_id TEXT,                                 -- 来源试卷ID
    
    user_answer TEXT,                             -- 用户的错误答案
    wrong_count INTEGER DEFAULT 1,                -- 累计错误次数
    is_mastered INTEGER DEFAULT 0,                -- 是否已掌握 0否 1是
    
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    last_wrong_at DATETIME DEFAULT CURRENT_TIMESTAMP,  -- 最近一次答错时间
    
    FOREIGN KEY (question_id) REFERENCES questions(id) ON DELETE CASCADE,
    FOREIGN KEY (exam_id) REFERENCES exams(id) ON DELETE SET NULL,
    UNIQUE(question_id)                           -- 每道题只保留一条错题记录
);

-- 索引
CREATE INDEX idx_wrong_questions_mastered ON wrong_questions(is_mastered);
CREATE INDEX idx_wrong_questions_count ON wrong_questions(wrong_count DESC);
CREATE INDEX idx_wrong_questions_last ON wrong_questions(last_wrong_at DESC);
```

#### 4.2.5 AI任务表 (ai_tasks)

```sql
-- AI批量任务表
CREATE TABLE ai_tasks (
    id TEXT PRIMARY KEY,                          -- UUID
    
    -- 任务类型
    type TEXT NOT NULL,                           -- answer/explanation/both/report
    
    -- 任务状态
    status TEXT DEFAULT 'pending',                -- pending/running/paused/completed/failed/cancelled
    
    -- 任务内容
    question_ids TEXT,                            -- JSON: 待处理题目ID列表
    total_count INTEGER DEFAULT 0,                -- 总数量
    completed_count INTEGER DEFAULT 0,            -- 已完成数量
    failed_count INTEGER DEFAULT 0,               -- 失败数量
    current_question_id TEXT,                     -- 当前正在处理的题目ID
    
    -- 任务关联（用于生成报告等场景）
    related_id TEXT,                              -- 关联ID，如exam_id
    
    -- 结果与错误
    result TEXT,                                  -- 任务结果（如报告内容）
    error_message TEXT,                           -- 错误信息
    
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    started_at DATETIME,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    completed_at DATETIME,
    
    CHECK (type IN ('answer', 'explanation', 'both', 'report')),
    CHECK (status IN ('pending', 'running', 'paused', 'completed', 'failed', 'cancelled'))
);

-- 索引
CREATE INDEX idx_ai_tasks_status ON ai_tasks(status);
CREATE INDEX idx_ai_tasks_created ON ai_tasks(created_at DESC);
```

**任务状态流转：**

```
pending ──▶ running ──▶ completed
    │          │
    │          ├──▶ paused ──▶ running (resume)
    │          │       │
    │          │       └──▶ cancelled
    │          │
    │          └──▶ failed
    │
    └──▶ cancelled
```

#### 4.2.6 学习统计表 (learning_stats)

```sql
-- 每日学习统计表
CREATE TABLE learning_stats (
    id TEXT PRIMARY KEY,                          -- UUID
    date DATE UNIQUE NOT NULL,                    -- 日期（唯一）
    
    questions_done INTEGER DEFAULT 0,             -- 当日完成题目数
    correct_count INTEGER DEFAULT 0,              -- 正确数
    wrong_count INTEGER DEFAULT 0,                -- 错误数
    study_time INTEGER DEFAULT 0,                 -- 学习时长(秒)
    exams_count INTEGER DEFAULT 0,                -- 完成试卷数
    
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 索引
CREATE INDEX idx_stats_date ON learning_stats(date DESC);
```

#### 4.2.7 系统设置表 (settings)

```sql
-- 系统设置表（键值对形式）
CREATE TABLE settings (
    key TEXT PRIMARY KEY,                         -- 设置键
    value TEXT,                                   -- 设置值
    description TEXT,                             -- 设置描述
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 初始化默认设置
INSERT INTO settings (key, value, description) VALUES 
    ('admin_password_hash', '', '管理员密码哈希值'),
    ('ai_api_url', 'https://api.openai.com/v1', 'AI API基础地址'),
    ('ai_api_key', '', 'AI API密钥'),
    ('ai_model', 'gpt-4o-mini', 'AI模型名称'),
    ('ai_max_tokens', '2000', 'AI单次请求最大token数'),
    ('ai_temperature', '0.7', 'AI生成温度参数'),
    ('site_title', '智能答题学习系统', '网站标题'),
    ('default_exam_time', '60', '默认考试时间(分钟)'),
    ('auto_collect_wrong', 'true', '是否自动收集错题'),
    ('initialized', 'false', '系统是否已初始化');
```

**常用设置键：**

| Key | 说明 | 默认值 |
|-----|------|--------|
| admin_password_hash | 管理员密码BCrypt哈希 | 空（首次需设置） |
| ai_api_url | AI接口地址 | https://api.openai.com/v1 |
| ai_api_key | AI接口密钥 | 空 |
| ai_model | AI模型名称 | gpt-4o-mini |
| ai_max_tokens | 最大token数 | 2000 |
| ai_temperature | 温度参数 | 0.7 |
| site_title | 网站标题 | 智能答题学习系统 |
| default_exam_time | 默认考试时间(分钟) | 60 |
| auto_collect_wrong | 自动收集错题 | true |
| initialized | 是否完成初始化 | false |

### 4.3 数据库初始化脚本

```sql
-- init.sql
-- 智能答题学习系统数据库初始化脚本

-- 启用外键约束
PRAGMA foreign_keys = ON;

-- 创建分类表
CREATE TABLE IF NOT EXISTS categories (
    id TEXT PRIMARY KEY,
    name TEXT NOT NULL,
    parent_id TEXT,
    description TEXT,
    sort_order INTEGER DEFAULT 0,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (parent_id) REFERENCES categories(id) ON DELETE SET NULL
);

-- 创建题目表
CREATE TABLE IF NOT EXISTS questions (
    id TEXT PRIMARY KEY,
    category_id TEXT,
    type TEXT NOT NULL CHECK (type IN ('single', 'multiple', 'judge', 'essay')),
    difficulty TEXT DEFAULT 'medium' CHECK (difficulty IN ('easy', 'medium', 'hard')),
    content TEXT NOT NULL,
    options TEXT,
    answer TEXT,
    answer_status TEXT DEFAULT 'none' CHECK (answer_status IN ('none', 'ai_pending', 'ai_generated', 'confirmed')),
    explanation TEXT,
    explanation_status TEXT DEFAULT 'none' CHECK (explanation_status IN ('none', 'ai_pending', 'ai_generated', 'confirmed')),
    tags TEXT,
    source TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE SET NULL
);

-- 创建考试表
CREATE TABLE IF NOT EXISTS exams (
    id TEXT PRIMARY KEY,
    title TEXT,
    config TEXT,
    question_ids TEXT,
    question_snapshots TEXT,
    answers TEXT,
    score REAL,
    total_score REAL,
    correct_count INTEGER DEFAULT 0,
    wrong_count INTEGER DEFAULT 0,
    time_spent INTEGER DEFAULT 0,
    status TEXT DEFAULT 'ongoing' CHECK (status IN ('ongoing', 'completed', 'abandoned')),
    ai_report TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    started_at DATETIME,
    completed_at DATETIME
);

-- 创建错题表
CREATE TABLE IF NOT EXISTS wrong_questions (
    id TEXT PRIMARY KEY,
    question_id TEXT NOT NULL,
    exam_id TEXT,
    user_answer TEXT,
    wrong_count INTEGER DEFAULT 1,
    is_mastered INTEGER DEFAULT 0,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    last_wrong_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (question_id) REFERENCES questions(id) ON DELETE CASCADE,
    FOREIGN KEY (exam_id) REFERENCES exams(id) ON DELETE SET NULL,
    UNIQUE(question_id)
);

-- 创建AI任务表
CREATE TABLE IF NOT EXISTS ai_tasks (
    id TEXT PRIMARY KEY,
    type TEXT NOT NULL CHECK (type IN ('answer', 'explanation', 'both', 'report')),
    status TEXT DEFAULT 'pending' CHECK (status IN ('pending', 'running', 'paused', 'completed', 'failed', 'cancelled')),
    question_ids TEXT,
    total_count INTEGER DEFAULT 0,
    completed_count INTEGER DEFAULT 0,
    failed_count INTEGER DEFAULT 0,
    current_question_id TEXT,
    related_id TEXT,
    result TEXT,
    error_message TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    started_at DATETIME,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    completed_at DATETIME
);

-- 创建学习统计表
CREATE TABLE IF NOT EXISTS learning_stats (
    id TEXT PRIMARY KEY,
    date DATE UNIQUE NOT NULL,
    questions_done INTEGER DEFAULT 0,
    correct_count INTEGER DEFAULT 0,
    wrong_count INTEGER DEFAULT 0,
    study_time INTEGER DEFAULT 0,
    exams_count INTEGER DEFAULT 0,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 创建设置表
CREATE TABLE IF NOT EXISTS settings (
    key TEXT PRIMARY KEY,
    value TEXT,
    description TEXT,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 创建索引
CREATE INDEX IF NOT EXISTS idx_categories_parent ON categories(parent_id);
CREATE INDEX IF NOT EXISTS idx_questions_category ON questions(category_id);
CREATE INDEX IF NOT EXISTS idx_questions_type ON questions(type);
CREATE INDEX IF NOT EXISTS idx_questions_difficulty ON questions(difficulty);
CREATE INDEX IF NOT EXISTS idx_questions_answer_status ON questions(answer_status);
CREATE INDEX IF NOT EXISTS idx_exams_status ON exams(status);
CREATE INDEX IF NOT EXISTS idx_exams_created ON exams(created_at DESC);
CREATE INDEX IF NOT EXISTS idx_wrong_questions_mastered ON wrong_questions(is_mastered);
CREATE INDEX IF NOT EXISTS idx_ai_tasks_status ON ai_tasks(status);
CREATE INDEX IF NOT EXISTS idx_stats_date ON learning_stats(date DESC);

-- 初始化默认设置
INSERT OR IGNORE INTO settings (key, value, description) VALUES 
    ('admin_password_hash', '', '管理员密码哈希值'),
    ('ai_api_url', 'https://api.openai.com/v1', 'AI API基础地址'),
    ('ai_api_key', '', 'AI API密钥'),
    ('ai_model', 'gpt-4o-mini', 'AI模型名称'),
    ('ai_max_tokens', '2000', 'AI单次请求最大token数'),
    ('ai_temperature', '0.7', 'AI生成温度参数'),
    ('site_title', '智能答题学习系统', '网站标题'),
    ('default_exam_time', '60', '默认考试时间(分钟)'),
    ('auto_collect_wrong', 'true', '是否自动收集错题'),
    ('initialized', 'false', '系统是否已初始化');

-- 插入默认分类
INSERT OR IGNORE INTO categories (id, name, description, sort_order) VALUES 
    ('default', '未分类', '默认分类，用于存放未分类的题目', 999);
```



## 5. API接口设计

### 5.1 接口规范

#### 5.1.1 基础规范

| 项目 | 规范 |
|------|------|
| 基础路径 | `/api` |
| 数据格式 | JSON |
| 字符编码 | UTF-8 |
| 时间格式 | ISO 8601 (`2024-01-20T10:30:00Z`) |
| 认证方式 | Bearer Token (JWT) |

#### 5.1.2 通用响应格式

**成功响应：**

```json
{
    "code": 0,
    "message": "success",
    "data": { ... }
}
```

**分页响应：**

```json
{
    "code": 0,
    "message": "success",
    "data": {
        "items": [ ... ],
        "total": 100,
        "page": 1,
        "pageSize": 20,
        "totalPages": 5
    }
}
```

**错误响应：**

```json
{
    "code": 40001,
    "message": "参数错误：题目内容不能为空",
    "data": null
}
```

#### 5.1.3 错误码定义

| 错误码 | 说明 |
|--------|------|
| 0 | 成功 |
| 40001 | 参数错误 |
| 40002 | 数据不存在 |
| 40003 | 数据已存在 |
| 40101 | 未登录/Token无效 |
| 40102 | Token已过期 |
| 40103 | 密码错误 |
| 50001 | 服务器内部错误 |
| 50002 | AI服务调用失败 |
| 50003 | 文件解析失败 |

#### 5.1.4 通用请求头

```
Authorization: Bearer <jwt_token>
Content-Type: application/json
```

---

### 5.2 接口概览

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           API 接口总览                                   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  🔐 认证模块 /api/auth                                                   │
│  ├── POST   /login                    登录                              │
│  ├── POST   /logout                   登出                              │
│  ├── GET    /verify                   验证Token                         │
│  ├── PUT    /password                 修改密码                          │
│  └── POST   /init                     初始化管理员密码                   │
│                                                                          │
│  📁 分类模块 /api/categories                                             │
│  ├── GET    /                         获取分类树                         │
│  ├── GET    /:id                      获取分类详情                       │
│  ├── POST   /                         创建分类                          │
│  ├── PUT    /:id                      更新分类                          │
│  └── DELETE /:id                      删除分类                          │
│                                                                          │
│  📝 题目模块 /api/questions                                              │
│  ├── GET    /                         获取题目列表                       │
│  ├── GET    /stats                    获取题库统计                       │
│  ├── GET    /:id                      获取题目详情                       │
│  ├── POST   /                         创建题目                          │
│  ├── PUT    /:id                      更新题目                          │
│  ├── DELETE /:id                      删除题目                          │
│  ├── DELETE /batch                    批量删除                          │
│  ├── POST   /import/preview           预览导入                          │
│  ├── POST   /import                   导入题目                          │
│  ├── GET    /export                   导出题目                          │
│  ├── PUT    /:id/confirm-answer       确认答案                          │
│  └── PUT    /:id/confirm-explanation  确认解析                          │
│                                                                          │
│  📋 考试模块 /api/exams                                                  │
│  ├── GET    /                         获取考试列表                       │
│  ├── GET    /:id                      获取考试详情                       │
│  ├── POST   /generate                 生成试卷                          │
│  ├── PUT    /:id/answer               保存答案                          │
│  ├── POST   /:id/submit               提交试卷                          │
│  ├── DELETE /:id                      删除考试记录                       │
│  └── GET    /:id/report               获取分析报告                       │
│                                                                          │
│  ❌ 错题模块 /api/wrong-questions                                        │
│  ├── GET    /                         获取错题列表                       │
│  ├── PUT    /:id/master               标记已掌握                         │
│  ├── PUT    /:id/unmaster             取消已掌握                         │
│  ├── DELETE /:id                      删除错题                          │
│  └── POST   /generate-exam            生成错题试卷                       │
│                                                                          │
│  🤖 AI模块 /api/ai                                                       │
│  ├── POST   /complete                 AI补全单题                         │
│  ├── POST   /complete/stream          AI补全(流式)                       │
│  ├── POST   /batch-complete           创建批量补全任务                   │
│  ├── GET    /tasks                    获取任务列表                       │
│  ├── GET    /tasks/:id                获取任务详情                       │
│  ├── PUT    /tasks/:id/pause          暂停任务                          │
│  ├── PUT    /tasks/:id/resume         恢复任务                          │
│  ├── PUT    /tasks/:id/cancel         取消任务                          │
│  ├── POST   /generate-report          生成分析报告                       │
│  ├── POST   /generate-report/stream   生成报告(流式)                     │
│  └── POST   /explain                  AI解释/追问                        │
│                                                                          │
│  📊 统计模块 /api/stats                                                  │
│  ├── GET    /overview                 学习概览                          │
│  ├── GET    /daily                    每日统计                          │
│  ├── GET    /category                 分类正确率                         │
│  └── GET    /weak-points              薄弱知识点                         │
│                                                                          │
│  ⚙️ 设置模块 /api/settings                                               │
│  ├── GET    /                         获取设置                          │
│  ├── PUT    /                         更新设置                          │
│  ├── POST   /test-ai                  测试AI连接                         │
│  ├── POST   /backup                   创建备份                          │
│  └── POST   /restore                  恢复数据                          │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

### 5.3 认证模块接口

#### POST /api/auth/init

**初始化管理员密码（首次使用）**

```yaml
请求:
  Content-Type: application/json
  Body:
    {
        "password": "admin123456"
    }

响应 (200):
    {
        "code": 0,
        "message": "初始化成功",
        "data": {
            "token": "eyJhbGciOiJIUzI1NiIs...",
            "expiresIn": 86400
        }
    }

响应 (400 已初始化):
    {
        "code": 40003,
        "message": "系统已初始化，请直接登录",
        "data": null
    }
```

#### POST /api/auth/login

**管理员登录**

```yaml
请求:
  Content-Type: application/json
  Body:
    {
        "password": "admin123456"
    }

响应 (200):
    {
        "code": 0,
        "message": "登录成功",
        "data": {
            "token": "eyJhbGciOiJIUzI1NiIs...",
            "expiresIn": 86400
        }
    }

响应 (401):
    {
        "code": 40103,
        "message": "密码错误",
        "data": null
    }
```

#### POST /api/auth/logout

**登出**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>

响应 (200):
    {
        "code": 0,
        "message": "登出成功",
        "data": null
    }
```

#### GET /api/auth/verify

**验证Token有效性**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>

响应 (200):
    {
        "code": 0,
        "message": "success",
        "data": {
            "valid": true,
            "initialized": true
        }
    }
```

#### PUT /api/auth/password

**修改密码**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Body:
    {
        "oldPassword": "admin123456",
        "newPassword": "newPassword789"
    }

响应 (200):
    {
        "code": 0,
        "message": "密码修改成功",
        "data": null
    }

响应 (401):
    {
        "code": 40103,
        "message": "原密码错误",
        "data": null
    }
```

---

### 5.4 分类模块接口

#### GET /api/categories

**获取分类树**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>

响应 (200):
    {
        "code": 0,
        "message": "success",
        "data": [
            {
                "id": "cat-001",
                "name": "计算机基础",
                "description": "计算机基础知识",
                "parentId": null,
                "sortOrder": 1,
                "questionCount": 45,
                "children": [
                    {
                        "id": "cat-002",
                        "name": "操作系统",
                        "description": "",
                        "parentId": "cat-001",
                        "sortOrder": 1,
                        "questionCount": 20,
                        "children": []
                    },
                    {
                        "id": "cat-003",
                        "name": "计算机网络",
                        "description": "",
                        "parentId": "cat-001",
                        "sortOrder": 2,
                        "questionCount": 25,
                        "children": []
                    }
                ]
            },
            {
                "id": "default",
                "name": "未分类",
                "description": "默认分类",
                "parentId": null,
                "sortOrder": 999,
                "questionCount": 10,
                "children": []
            }
        ]
    }
```

#### GET /api/categories/:id

**获取分类详情**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Path:
    id: "cat-001"

响应 (200):
    {
        "code": 0,
        "message": "success",
        "data": {
            "id": "cat-001",
            "name": "计算机基础",
            "description": "计算机基础知识",
            "parentId": null,
            "sortOrder": 1,
            "questionCount": 45,
            "createdAt": "2024-01-15T10:00:00Z",
            "updatedAt": "2024-01-20T15:30:00Z"
        }
    }
```

#### POST /api/categories

**创建分类**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Body:
    {
        "name": "数据结构",
        "parentId": "cat-001",
        "description": "数据结构与算法",
        "sortOrder": 3
    }

响应 (200):
    {
        "code": 0,
        "message": "创建成功",
        "data": {
            "id": "cat-004",
            "name": "数据结构",
            "parentId": "cat-001",
            "description": "数据结构与算法",
            "sortOrder": 3,
            "createdAt": "2024-01-20T16:00:00Z",
            "updatedAt": "2024-01-20T16:00:00Z"
        }
    }
```

#### PUT /api/categories/:id

**更新分类**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Path:
    id: "cat-004"
  Body:
    {
        "name": "数据结构与算法",
        "description": "包含各种数据结构和常用算法"
    }

响应 (200):
    {
        "code": 0,
        "message": "更新成功",
        "data": {
            "id": "cat-004",
            "name": "数据结构与算法",
            ...
        }
    }
```

#### DELETE /api/categories/:id

**删除分类**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Path:
    id: "cat-004"

响应 (200):
    {
        "code": 0,
        "message": "删除成功，该分类下的5道题目已移至未分类",
        "data": {
            "movedQuestions": 5
        }
    }
```

---

### 5.5 题目模块接口

#### GET /api/questions

**获取题目列表**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Query:
    page: 1                              # 页码，默认1
    pageSize: 20                         # 每页数量，默认20，最大100
    keyword: "HTTP"                      # 搜索关键词（搜索题干）
    categoryId: "cat-001"                # 分类ID
    type: "single"                       # 题型: single/multiple/judge/essay
    difficulty: "medium"                 # 难度: easy/medium/hard
    status: "incomplete"                 # 补全状态: all/complete/incomplete
    answerStatus: "none"                 # 答案状态: none/ai_generated/confirmed
    explanationStatus: "ai_generated"    # 解析状态: none/ai_generated/confirmed
    sortBy: "createdAt"                  # 排序字段: createdAt/updatedAt
    sortOrder: "desc"                    # 排序方向: asc/desc

响应 (200):
    {
        "code": 0,
        "message": "success",
        "data": {
            "items": [
                {
                    "id": "q-001",
                    "categoryId": "cat-003",
                    "categoryName": "计算机网络",
                    "type": "single",
                    "difficulty": "easy",
                    "content": "HTTP状态码200表示什么？",
                    "options": {
                        "A": "请求成功",
                        "B": "重定向",
                        "C": "客户端错误",
                        "D": "服务器错误"
                    },
                    "answer": "A",
                    "answerStatus": "confirmed",
                    "explanation": "HTTP状态码200表示请求成功...",
                    "explanationStatus": "confirmed",
                    "tags": ["HTTP", "状态码"],
                    "source": "2024年期末考试",
                    "createdAt": "2024-01-15T10:00:00Z",
                    "updatedAt": "2024-01-15T10:00:00Z"
                },
                {
                    "id": "q-002",
                    "categoryId": "cat-003",
                    "categoryName": "计算机网络",
                    "type": "single",
                    "difficulty": "medium",
                    "content": "TCP三次握手的第一步是？",
                    "options": {
                        "A": "SYN",
                        "B": "ACK",
                        "C": "FIN",
                        "D": "RST"
                    },
                    "answer": null,
                    "answerStatus": "none",
                    "explanation": null,
                    "explanationStatus": "none",
                    "tags": ["TCP", "网络协议"],
                    "source": null,
                    "createdAt": "2024-01-16T14:00:00Z",
                    "updatedAt": "2024-01-16T14:00:00Z"
                }
            ],
            "total": 156,
            "page": 1,
            "pageSize": 20,
            "totalPages": 8
        }
    }
```

#### GET /api/questions/stats

**获取题库统计**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>

响应 (200):
    {
        "code": 0,
        "message": "success",
        "data": {
            "total": 256,
            "byType": {
                "single": 120,
                "multiple": 60,
                "judge": 50,
                "essay": 26
            },
            "byDifficulty": {
                "easy": 80,
                "medium": 120,
                "hard": 56
            },
            "byStatus": {
                "complete": 150,
                "hasAnswer": 30,
                "incomplete": 76
            },
            "byAnswerStatus": {
                "none": 76,
                "ai_generated": 20,
                "confirmed": 160
            },
            "byExplanationStatus": {
                "none": 106,
                "ai_generated": 15,
                "confirmed": 135
            }
        }
    }
```

#### GET /api/questions/:id

**获取题目详情**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Path:
    id: "q-001"

响应 (200):
    {
        "code": 0,
        "message": "success",
        "data": {
            "id": "q-001",
            "categoryId": "cat-003",
            "categoryName": "计算机网络",
            "type": "single",
            "difficulty": "easy",
            "content": "HTTP状态码200表示什么？",
            "options": {
                "A": "请求成功",
                "B": "重定向",
                "C": "客户端错误",
                "D": "服务器错误"
            },
            "answer": "A",
            "answerStatus": "confirmed",
            "explanation": "HTTP状态码200表示请求成功。\n\nHTTP状态码分类：\n- 1xx：信息性响应\n- 2xx：成功\n- 3xx：重定向\n- 4xx：客户端错误\n- 5xx：服务器错误",
            "explanationStatus": "confirmed",
            "tags": ["HTTP", "状态码"],
            "source": "2024年期末考试",
            "createdAt": "2024-01-15T10:00:00Z",
            "updatedAt": "2024-01-18T11:30:00Z"
        }
    }
```

#### POST /api/questions

**创建题目**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Body:
    {
        "categoryId": "cat-003",
        "type": "single",
        "difficulty": "medium",
        "content": "以下哪个不是HTTP请求方法？",
        "options": {
            "A": "GET",
            "B": "POST",
            "C": "PUSH",
            "D": "DELETE"
        },
        "answer": "C",
        "explanation": "HTTP标准请求方法包括GET、POST、PUT、DELETE等，不包含PUSH。",
        "tags": ["HTTP", "请求方法"],
        "source": "自定义"
    }

响应 (200):
    {
        "code": 0,
        "message": "创建成功",
        "data": {
            "id": "q-new-001",
            "categoryId": "cat-003",
            "type": "single",
            ...
            "answerStatus": "confirmed",
            "explanationStatus": "confirmed",
            "createdAt": "2024-01-20T16:30:00Z",
            "updatedAt": "2024-01-20T16:30:00Z"
        }
    }

说明:
  - 如果提供了answer，answerStatus自动设为confirmed
  - 如果提供了explanation，explanationStatus自动设为confirmed
  - 如果未提供，对应status设为none
```

#### PUT /api/questions/:id

**更新题目**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Path:
    id: "q-001"
  Body:
    {
        "difficulty": "hard",
        "content": "HTTP状态码200的含义是什么？（修改后）",
        "answer": "A",
        "explanation": "更新后的解析内容..."
    }

响应 (200):
    {
        "code": 0,
        "message": "更新成功",
        "data": {
            "id": "q-001",
            ...
            "updatedAt": "2024-01-20T17:00:00Z"
        }
    }
```

#### DELETE /api/questions/:id

**删除题目**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Path:
    id: "q-001"

响应 (200):
    {
        "code": 0,
        "message": "删除成功",
        "data": null
    }
```

#### DELETE /api/questions/batch

**批量删除题目**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Body:
    {
        "ids": ["q-001", "q-002", "q-003"]
    }

响应 (200):
    {
        "code": 0,
        "message": "成功删除3道题目",
        "data": {
            "deleted": 3
        }
    }
```

#### POST /api/questions/import/preview

**预览导入内容**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
    Content-Type: multipart/form-data
  Body:
    file: (文件二进制)    # 支持 .docx/.xlsx/.csv/.txt/.json

响应 (200):
    {
        "code": 0,
        "message": "success",
        "data": {
            "questions": [
                {
                    "index": 1,
                    "type": "single",
                    "content": "中华人民共和国成立是哪一年？",
                    "options": {
                        "A": "1945",
                        "B": "1948",
                        "C": "1949",
                        "D": "1950"
                    },
                    "answer": "C",
                    "explanation": null,
                    "hasAnswer": true,
                    "hasExplanation": false,
                    "parseStatus": "success"
                },
                {
                    "index": 2,
                    "type": "judge",
                    "content": "地球是太阳系最大的行星。",
                    "options": null,
                    "answer": null,
                    "explanation": null,
                    "hasAnswer": false,
                    "hasExplanation": false,
                    "parseStatus": "success"
                },
                {
                    "index": 3,
                    "type": "unknown",
                    "content": "这是一道无法识别格式的题目...",
                    "options": null,
                    "answer": null,
                    "explanation": null,
                    "hasAnswer": false,
                    "hasExplanation": false,
                    "parseStatus": "warning",
                    "parseMessage": "无法识别题目类型"
                }
            ],
            "statistics": {
                "total": 50,
                "success": 48,
                "warning": 2,
                "complete": 10,
                "hasAnswer": 20,
                "onlyContent": 18,
                "byType": {
                    "single": 25,
                    "multiple": 10,
                    "judge": 10,
                    "essay": 3,
                    "unknown": 2
                }
            }
        }
    }
```

#### POST /api/questions/import

**导入题目**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
    Content-Type: multipart/form-data
  Body:
    file: (文件二进制)
    categoryId: "cat-001"           # 目标分类ID（可选）
    defaultType: "single"           # 默认题型（可选）
    defaultDifficulty: "medium"     # 默认难度（可选）
    skipErrors: true                # 是否跳过错误继续导入（可选）

响应 (200):
    {
        "code": 0,
        "message": "导入完成",
        "data": {
            "total": 50,
            "success": 48,
            "failed": 2,
            "created": [
                {"id": "q-new-001", "content": "..."},
                {"id": "q-new-002", "content": "..."}
                ...
            ],
            "errors": [
                {"line": 15, "message": "无法解析题目格式"},
                {"line": 32, "message": "选项格式错误"}
            ]
        }
    }
```

#### GET /api/questions/export

**导出题目**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Query:
    format: "json"                # 格式: json/xlsx/md
    categoryId: "cat-001"         # 分类ID（可选，不传导出全部）
    ids: "q-001,q-002,q-003"      # 指定题目ID（可选，逗号分隔）
    includeIncomplete: false      # 是否包含未补全题目，默认true

响应 (200):
  Content-Type: application/octet-stream
  Content-Disposition: attachment; filename="questions_20240120.json"
  
  (文件二进制内容)

导出JSON格式示例:
{
    "exportTime": "2024-01-20T10:00:00Z",
    "totalCount": 150,
    "questions": [
        {
            "type": "single",
            "difficulty": "easy",
            "content": "HTTP状态码200表示什么？",
            "options": {"A":"成功","B":"重定向","C":"错误","D":"超时"},
            "answer": "A",
            "explanation": "200表示请求成功...",
            "category": "计算机网络",
            "tags": ["HTTP", "状态码"]
        }
    ]
}
```

#### PUT /api/questions/:id/confirm-answer

**确认AI生成的答案**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Path:
    id: "q-002"
  Body:
    {
        "answer": "A"    # 可选，可修改后确认
    }

响应 (200):
    {
        "code": 0,
        "message": "答案已确认",
        "data": {
            "id": "q-002",
            "answer": "A",
            "answerStatus": "confirmed"
        }
    }
```

#### PUT /api/questions/:id/confirm-explanation

**确认AI生成的解析**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Path:
    id: "q-002"
  Body:
    {
        "explanation": "修改后的解析内容..."    # 可选
    }

响应 (200):
    {
        "code": 0,
        "message": "解析已确认",
        "data": {
            "id": "q-002",
            "explanation": "修改后的解析内容...",
            "explanationStatus": "confirmed"
        }
    }
```

---

### 5.6 考试模块接口

#### POST /api/exams/generate

**生成试卷**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Body:
    {
        "title": "计算机网络随机测试",
        "mode": "exam",                           # exam/practice/review
        "timeLimit": 60,                          # 分钟，0表示不限时
        "questionConfig": [
            {
                "type": "single",
                "count": 20,
                "score": 2,
                "difficulty": "mixed"             # easy/medium/hard/mixed
            },
            {
                "type": "multiple",
                "count": 10,
                "score": 3,
                "difficulty": "medium"
            },
            {
                "type": "judge",
                "count": 10,
                "score": 1
            },
            {
                "type": "essay",
                "count": 2,
                "score": 10
            }
        ],
        "categoryIds": ["cat-003"],               # 限定分类，空数组表示全部
        "excludeIds": ["q-001", "q-002"],         # 排除指定题目
        "onlyConfirmed": true,                    # 仅使用已确认的题目
        "shuffleOptions": true                    # 打乱选项顺序
    }

响应 (200):
    {
        "code": 0,
        "message": "试卷生成成功",
        "data": {
            "id": "exam-001",
            "title": "计算机网络随机测试",
            "mode": "exam",
            "timeLimit": 60,
            "totalScore": 90,
            "questionCount": 42,
            "status": "ongoing",
            "questions": [
                {
                    "id": "q-001",
                    "type": "single",
                    "content": "HTTP状态码200表示什么？",
                    "options": {
                        "A": "请求成功",
                        "B": "重定向",
                        "C": "客户端错误",
                        "D": "服务器错误"
                    },
                    "score": 2
                    // 考试模式下不返回answer和explanation
                }
            ],
            "createdAt": "2024-01-20T10:00:00Z",
            "startedAt": null
        }
    }

响应 (400 题目不足):
    {
        "code": 40001,
        "message": "题库中符合条件的单选题仅有15道，不满足20道的要求",
        "data": {
            "required": {"single": 20, "multiple": 10},
            "available": {"single": 15, "multiple": 12}
        }
    }
```

#### GET /api/exams

**获取考试列表**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Query:
    page: 1
    pageSize: 20
    status: "all"         # ongoing/completed/abandoned/all

响应 (200):
    {
        "code": 0,
        "message": "success",
        "data": {
            "items": [
                {
                    "id": "exam-001",
                    "title": "计算机网络随机测试",
                    "mode": "exam",
                    "questionCount": 42,
                    "totalScore": 90,
                    "score": 75,
                    "correctRate": 0.83,
                    "timeLimit": 60,
                    "timeSpent": 2580,
                    "status": "completed",
                    "createdAt": "2024-01-20T10:00:00Z",
                    "completedAt": "2024-01-20T10:45:00Z"
                },
                {
                    "id": "exam-002",
                    "title": "数据结构专项练习",
                    "mode": "practice",
                    "questionCount": 30,
                    "totalScore": 60,
                    "score": null,
                    "timeLimit": 0,
                    "timeSpent": 1200,
                    "status": "ongoing",
                    "createdAt": "2024-01-20T14:00:00Z",
                    "completedAt": null
                }
            ],
            "total": 25,
            "page": 1,
            "pageSize": 20,
            "totalPages": 2
        }
    }
```

#### GET /api/exams/:id

**获取考试详情**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Path:
    id: "exam-001"

响应 (200 - 进行中):
    {
        "code": 0,
        "message": "success",
        "data": {
            "id": "exam-001",
            "title": "计算机网络随机测试",
            "mode": "exam",
            "timeLimit": 60,
            "totalScore": 90,
            "status": "ongoing",
            "questions": [
                {
                    "id": "q-001",
                    "type": "single",
                    "content": "HTTP状态码200表示什么？",
                    "options": {...},
                    "score": 2
                    // 不返回答案
                }
            ],
            "answers": {
                "q-001": "A",
                "q-003": "B"
            },
            "timeSpent": 1200,
            "startedAt": "2024-01-20T10:00:00Z"
        }
    }

响应 (200 - 已完成):
    {
        "code": 0,
        "message": "success",
        "data": {
            "id": "exam-001",
            "title": "计算机网络随机测试",
            "mode": "exam",
            "timeLimit": 60,
            "totalScore": 90,
            "score": 75,
            "correctCount": 35,
            "wrongCount": 7,
            "correctRate": 0.83,
            "status": "completed",
            "questions": [
                {
                    "id": "q-001",
                    "type": "single",
                    "content": "HTTP状态码200表示什么？",
                    "options": {...},
                    "score": 2,
                    "answer": "A",
                    "explanation": "...",
                    "userAnswer": "A",
                    "isCorrect": true,
                    "earnedScore": 2
                }
            ],
            "timeSpent": 2580,
            "aiReport": null,
            "completedAt": "2024-01-20T10:45:00Z"
        }
    }
```

#### PUT /api/exams/:id/answer

**保存答案（自动保存/暂存）**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Path:
    id: "exam-001"
  Body:
    {
        "answers": {
            "q-001": "A",
            "q-002": "BC",
            "q-003": "正确"
        },
        "timeSpent": 1500
    }

响应 (200):
    {
        "code": 0,
        "message": "已保存",
        "data": {
            "savedAt": "2024-01-20T10:25:00Z"
        }
    }
```

#### POST /api/exams/:id/submit

**提交试卷**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Path:
    id: "exam-001"
  Body:
    {
        "answers": {
            "q-001": "A",
            "q-002": "BC",
            ...
        },
        "timeSpent": 2580
    }

响应 (200):
    {
        "code": 0,
        "message": "提交成功",
        "data": {
            "id": "exam-001",
            "score": 75,
            "totalScore": 90,
            "correctCount": 35,
            "wrongCount": 7,
            "correctRate": 0.83,
            "timeSpent": 2580,
            "details": [
                {
                    "questionId": "q-001",
                    "type": "single",
                    "content": "HTTP状态码200表示什么？",
                    "options": {...},
                    "correctAnswer": "A",
                    "userAnswer": "A",
                    "isCorrect": true,
                    "score": 2,
                    "earnedScore": 2,
                    "explanation": "...",
                    "explanationStatus": "confirmed"
                },
                {
                    "questionId": "q-002",
                    "type": "multiple",
                    "content": "...",
                    "correctAnswer": "ACD",
                    "userAnswer": "AC",
                    "isCorrect": false,
                    "score": 3,
                    "earnedScore": 0,
                    "explanation": null,
                    "explanationStatus": "none"
                }
            ],
            "wrongQuestionIds": ["q-002", "q-005", ...],
            "completedAt": "2024-01-20T10:45:00Z"
        }
    }
```

#### DELETE /api/exams/:id

**删除考试记录**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Path:
    id: "exam-001"

响应 (200):
    {
        "code": 0,
        "message": "删除成功",
        "data": null
    }
```

#### GET /api/exams/:id/report

**获取AI分析报告**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Path:
    id: "exam-001"

响应 (200 - 已有报告):
    {
        "code": 0,
        "message": "success",
        "data": {
            "examId": "exam-001",
            "report": "## 学习分析报告\n\n### 错题知识点统计\n...",
            "generatedAt": "2024-01-20T11:00:00Z"
        }
    }

响应 (200 - 无报告):
    {
        "code": 0,
        "message": "success",
        "data": {
            "examId": "exam-001",
            "report": null,
            "generatedAt": null
        }
    }
```

---

### 5.7 错题模块接口

#### GET /api/wrong-questions

**获取错题列表**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Query:
    page: 1
    pageSize: 20
    categoryId: "cat-001"        # 分类筛选
    type: "single"               # 题型筛选
    isMastered: false            # 是否已掌握

响应 (200):
    {
        "code": 0,
        "message": "success",
        "data": {
            "items": [
                {
                    "id": "wq-001",
                    "questionId": "q-002",
                    "question": {
                        "id": "q-002",
                        "type": "single",
                        "content": "TCP三次握手...",
                        "options": {...},
                        "answer": "A",
                        "explanation": "...",
                        "categoryName": "计算机网络"
                    },
                    "userAnswer": "C",
                    "wrongCount": 3,
                    "isMastered": false,
                    "lastWrongAt": "2024-01-20T10:45:00Z",
                    "createdAt": "2024-01-15T14:00:00Z"
                }
            ],
            "total": 45,
            "page": 1,
            "pageSize": 20,
            "totalPages": 3
        }
    }
```

#### PUT /api/wrong-questions/:id/master

**标记已掌握**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Path:
    id: "wq-001"

响应 (200):
    {
        "code": 0,
        "message": "已标记为掌握",
        "data": {
            "id": "wq-001",
            "isMastered": true
        }
    }
```

#### PUT /api/wrong-questions/:id/unmaster

**取消已掌握**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Path:
    id: "wq-001"

响应 (200):
    {
        "code": 0,
        "message": "已取消掌握标记",
        "data": {
            "id": "wq-001",
            "isMastered": false
        }
    }
```

#### DELETE /api/wrong-questions/:id

**删除错题记录**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Path:
    id: "wq-001"

响应 (200):
    {
        "code": 0,
        "message": "删除成功",
        "data": null
    }
```

#### POST /api/wrong-questions/generate-exam

**从错题生成试卷**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Body:
    {
        "count": 20,              # 题目数量
        "mode": "exam",           # exam/practice
        "timeLimit": 30,
        "onlyUnmastered": true    # 仅未掌握的错题
    }

响应 (200):
    {
        "code": 0,
        "message": "试卷生成成功",
        "data": {
            "id": "exam-wrong-001",
            "title": "错题重做练习",
            "questionCount": 20,
            ...
        }
    }
```

---

### 5.8 AI模块接口

#### POST /api/ai/complete

**AI补全单题**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Body:
    {
        "questionId": "q-002",
        "type": "both"            # answer/explanation/both
    }

响应 (200):
    {
        "code": 0,
        "message": "生成成功",
        "data": {
            "questionId": "q-002",
            "answer": "A",
            "explanation": "TCP三次握手的第一步是客户端发送SYN包...\n\n三次握手过程：\n1. 客户端发送SYN\n2. 服务器回复SYN+ACK\n3. 客户端发送ACK",
            "answerStatus": "ai_generated",
            "explanationStatus": "ai_generated"
        }
    }
```

#### POST /api/ai/complete/stream

**AI补全（流式输出）**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Body:
    {
        "questionId": "q-002",
        "type": "both"
    }

响应 (200):
  Content-Type: text/event-stream

  data: {"type": "answer", "content": "A"}

  data: {"type": "explanation", "content": "TCP"}
  data: {"type": "explanation", "content": "三次"}
  data: {"type": "explanation", "content": "握手"}
  data: {"type": "explanation", "content": "的第一步..."}
  ...
  data: {"type": "done", "questionId": "q-002"}
```

#### POST /api/ai/batch-complete

**创建批量补全任务**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Body:
    {
        "questionIds": ["q-002", "q-003", "q-004"],  # 可选，为空则处理全部待补全
        "type": "both",                              # answer/explanation/both
        "filter": {                                  # questionIds为空时的筛选条件
            "categoryId": "cat-001",
            "answerStatus": "none",
            "explanationStatus": "none"
        }
    }

响应 (200):
    {
        "code": 0,
        "message": "任务已创建",
        "data": {
            "taskId": "task-001",
            "type": "both",
            "totalCount": 50,
            "status": "pending",
            "createdAt": "2024-01-20T16:00:00Z"
        }
    }
```

#### GET /api/ai/tasks

**获取AI任务列表**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Query:
    status: "running"       # pending/running/paused/completed/failed/cancelled/all

响应 (200):
    {
        "code": 0,
        "message": "success",
        "data": {
            "items": [
                {
                    "id": "task-001",
                    "type": "both",
                    "status": "running",
                    "totalCount": 50,
                    "completedCount": 23,
                    "failedCount": 1,
                    "progress": 0.46,
                    "currentQuestionId": "q-025",
                    "createdAt": "2024-01-20T16:00:00Z",
                    "startedAt": "2024-01-20T16:00:05Z",
                    "updatedAt": "2024-01-20T16:15:30Z"
                }
            ],
            "total": 5
        }
    }
```

#### GET /api/ai/tasks/:id

**获取AI任务详情**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Path:
    id: "task-001"

响应 (200):
    {
        "code": 0,
        "message": "success",
        "data": {
            "id": "task-001",
            "type": "both",
            "status": "running",
            "totalCount": 50,
            "completedCount": 23,
            "failedCount": 1,
            "progress": 0.46,
            "questionIds": ["q-002", "q-003", ...],
            "currentQuestionId": "q-025",
            "errorMessage": null,
            "createdAt": "2024-01-20T16:00:00Z",
            "startedAt": "2024-01-20T16:00:05Z",
            "updatedAt": "2024-01-20T16:15:30Z",
            "completedAt": null
        }
    }
```

#### PUT /api/ai/tasks/:id/pause

**暂停AI任务**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Path:
    id: "task-001"

响应 (200):
    {
        "code": 0,
        "message": "任务已暂停",
        "data": {
            "id": "task-001",
            "status": "paused",
            "completedCount": 25
        }
    }
```

#### PUT /api/ai/tasks/:id/resume

**恢复AI任务**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Path:
    id: "task-001"

响应 (200):
    {
        "code": 0,
        "message": "任务已恢复",
        "data": {
            "id": "task-001",
            "status": "running"
        }
    }
```

#### PUT /api/ai/tasks/:id/cancel

**取消AI任务**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Path:
    id: "task-001"

响应 (200):
    {
        "code": 0,
        "message": "任务已取消",
        "data": {
            "id": "task-001",
            "status": "cancelled",
            "completedCount": 25
        }
    }
```

#### POST /api/ai/generate-report

**生成学习分析报告**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Body:
    {
        "examId": "exam-001"
    }

响应 (200):
    {
        "code": 0,
        "message": "报告生成成功",
        "data": {
            "examId": "exam-001",
            "report": "## 📊 学习分析报告\n\n### 一、答题概况\n\n- **总题数**：42道\n- **正确数**：35道\n- **错误数**：7道\n- **正确率**：83.3%\n\n### 二、错题知识点统计\n\n| 知识点 | 错题数 |\n|--------|--------|\n| HTTP协议 | 2 |\n| TCP/IP | 3 |\n| 数据库索引 | 2 |\n\n### 三、薄弱点分析\n\n#### 1. TCP/IP协议\n你在TCP三次握手和四次挥手相关题目上存在理解偏差...\n\n### 四、学习建议\n\n1. 重点复习TCP/IP协议...\n2. 建议刷20道HTTP协议专项练习...",
            "generatedAt": "2024-01-20T11:00:00Z"
        }
    }
```

#### POST /api/ai/generate-report/stream

**生成学习分析报告（流式）**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Body:
    {
        "examId": "exam-001"
    }

响应 (200):
  Content-Type: text/event-stream

  data: {"content": "## 📊 学习分析报告\n\n"}
  data: {"content": "### 一、答题概况\n\n"}
  data: {"content": "- **总题数**：42道\n"}
  ...
  data: {"type": "done", "examId": "exam-001"}
```

#### POST /api/ai/explain

**AI解释/追问**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Body:
    {
        "questionId": "q-002",
        "query": "为什么第一步是发送SYN包？SYN是什么意思？"
    }

响应 (200):
    {
        "code": 0,
        "message": "success",
        "data": {
            "questionId": "q-002",
            "query": "为什么第一步是发送SYN包？SYN是什么意思？",
            "answer": "SYN是Synchronize的缩写，意为\"同步\"。\n\n在TCP连接建立过程中：\n\n1. **SYN包的作用**：客户端发送SYN包是为了告诉服务器\"我想和你建立连接，这是我的初始序列号\"...\n\n2. **为什么是第一步**：这是TCP协议规定的连接建立流程..."
        }
    }
```

---

### 5.9 统计模块接口

#### GET /api/stats/overview

**获取学习概览**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>

响应 (200):
    {
        "code": 0,
        "message": "success",
        "data": {
            "questionBank": {
                "total": 256,
                "complete": 180,
                "incomplete": 76
            },
            "learning": {
                "totalExams": 45,
                "totalQuestionsDone": 1250,
                "totalCorrect": 980,
                "totalWrong": 270,
                "correctRate": 0.784,
                "totalStudyTime": 54000,
                "streakDays": 7,
                "todayDone": 30
            },
            "wrongQuestions": {
                "total": 89,
                "unmastered": 65,
                "mastered": 24
            },
            "recentExams": [
                {
                    "id": "exam-001",
                    "title": "计算机网络测试",
                    "score": 85,
                    "totalScore": 100,
                    "completedAt": "2024-01-20T10:45:00Z"
                }
            ]
        }
    }
```

#### GET /api/stats/daily

**获取每日学习数据**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Query:
    startDate: "2024-01-01"
    endDate: "2024-01-20"

响应 (200):
    {
        "code": 0,
        "message": "success",
        "data": [
            {
                "date": "2024-01-20",
                "questionsDone": 30,
                "correctCount": 25,
                "wrongCount": 5,
                "correctRate": 0.833,
                "studyTime": 3600,
                "examsCount": 2
            },
            {
                "date": "2024-01-19",
                "questionsDone": 45,
                "correctCount": 38,
                "wrongCount": 7,
                "correctRate": 0.844,
                "studyTime": 5400,
                "examsCount": 3
            }
        ]
    }
```

#### GET /api/stats/category

**按分类统计正确率**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>

响应 (200):
    {
        "code": 0,
        "message": "success",
        "data": [
            {
                "categoryId": "cat-001",
                "categoryName": "计算机网络",
                "totalDone": 150,
                "correctCount": 120,
                "wrongCount": 30,
                "correctRate": 0.80
            },
            {
                "categoryId": "cat-002",
                "categoryName": "数据结构",
                "totalDone": 100,
                "correctCount": 75,
                "wrongCount": 25,
                "correctRate": 0.75
            }
        ]
    }
```

#### GET /api/stats/weak-points

**获取薄弱知识点**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Query:
    limit: 10             # 返回数量

响应 (200):
    {
        "code": 0,
        "message": "success",
        "data": [
            {
                "categoryId": "cat-003",
                "categoryName": "数据库",
                "tag": "索引优化",
                "totalDone": 20,
                "wrongCount": 12,
                "wrongRate": 0.60,
                "recentWrongQuestions": [
                    {"id": "q-101", "content": "B+树索引的特点..."}
                ]
            },
            {
                "categoryId": "cat-001",
                "categoryName": "计算机网络",
                "tag": "TCP/IP",
                "totalDone": 30,
                "wrongCount": 15,
                "wrongRate": 0.50,
                "recentWrongQuestions": [...]
            }
        ]
    }
```

---

### 5.10 设置模块接口

#### GET /api/settings

**获取系统设置**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>

响应 (200):
    {
        "code": 0,
        "message": "success",
        "data": {
            "ai": {
                "apiUrl": "https://api.openai.com/v1",
                "model": "gpt-4o-mini",
                "maxTokens": 2000,
                "temperature": 0.7,
                "hasApiKey": true           # 不返回实际key，只返回是否已设置
            },
            "site": {
                "title": "智能答题学习系统"
            },
            "exam": {
                "defaultTimeLimit": 60,
                "autoCollectWrong": true
            },
            "system": {
                "initialized": true,
                "version": "1.0.0",
                "dbSize": "15.6 MB"
            }
        }
    }
```

#### PUT /api/settings

**更新设置**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Body:
    {
        "ai": {
            "apiUrl": "https://api.deepseek.com/v1",
            "apiKey": "sk-xxxxx",            # 可选，不传则不修改
            "model": "deepseek-chat",
            "maxTokens": 3000,
            "temperature": 0.8
        },
        "site": {
            "title": "我的学习系统"
        },
        "exam": {
            "defaultTimeLimit": 45,
            "autoCollectWrong": true
        }
    }

响应 (200):
    {
        "code": 0,
        "message": "设置已更新",
        "data": null
    }
```

#### POST /api/settings/test-ai

**测试AI连接**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
  Body:
    {
        "apiUrl": "https://api.openai.com/v1",
        "apiKey": "sk-xxxxx",
        "model": "gpt-4o-mini"
    }

响应 (200 成功):
    {
        "code": 0,
        "message": "连接成功",
        "data": {
            "success": true,
            "model": "gpt-4o-mini",
            "responseTime": 1250
        }
    }

响应 (200 失败):
    {
        "code": 0,
        "message": "连接失败",
        "data": {
            "success": false,
            "error": "Invalid API key"
        }
    }
```

#### POST /api/settings/backup

**创建数据备份**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>

响应 (200):
  Content-Type: application/octet-stream
  Content-Disposition: attachment; filename="quiz_backup_20240120_160000.zip"
  
  (备份文件二进制)

备份内容:
  - quiz.db (数据库文件)
  - metadata.json (备份信息)
```

#### POST /api/settings/restore

**恢复数据**

```yaml
请求:
  Headers:
    Authorization: Bearer <token>
    Content-Type: multipart/form-data
  Body:
    file: (备份文件)

响应 (200):
    {
        "code": 0,
        "message": "恢复成功",
        "data": {
            "backupTime": "2024-01-15T10:00:00Z",
            "questionsCount": 256,
            "examsCount": 45,
            "categoriesCount": 12
        }
    }

响应 (400):
    {
        "code": 50003,
        "message": "备份文件格式错误或已损坏",
        "data": null
    }
```



## 6. 前端页面设计

### 6.1 页面结构总览

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           页面结构图                                     │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  📱 页面列表                                                             │
│  │                                                                       │
│  ├── 🔐 Login.vue                    登录页（初始化/登录）               │
│  │                                                                       │
│  ├── 🏠 Dashboard.vue                首页仪表盘                          │
│  │                                                                       │
│  ├── 📚 题库管理                                                         │
│  │   ├── QuestionList.vue            题目列表                            │
│  │   ├── QuestionDetail.vue          题目详情                            │
│  │   ├── QuestionCreate.vue          添加题目                            │
│  │   ├── QuestionEdit.vue            编辑题目                            │
│  │   ├── QuestionImport.vue          导入题目                            │
│  │   └── CategoryManage.vue          分类管理                            │
│  │                                                                       │
│  ├── 📝 组卷答题                                                         │
│  │   ├── ExamCreate.vue              创建试卷                            │
│  │   ├── ExamTaking.vue              答题页面                            │
│  │   ├── ExamResult.vue              答题结果                            │
│  │   └── ExamHistory.vue             答题历史                            │
│  │                                                                       │
│  ├── 📊 学习追踪                                                         │
│  │   ├── WrongQuestions.vue          错题本                              │
│  │   └── Statistics.vue              学习统计                            │
│  │                                                                       │
│  └── ⚙️ Settings.vue                 系统设置                            │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 6.2 路由配置

```typescript
// router/index.ts
import { createRouter, createWebHistory } from 'vue-router'

const routes = [
  {
    path: '/login',
    name: 'Login',
    component: () => import('@/views/Login.vue'),
    meta: { requiresAuth: false }
  },
  {
    path: '/',
    component: () => import('@/layouts/MainLayout.vue'),
    meta: { requiresAuth: true },
    children: [
      {
        path: '',
        name: 'Dashboard',
        component: () => import('@/views/Dashboard.vue')
      },
      // 题库管理
      {
        path: 'questions',
        name: 'QuestionList',
        component: () => import('@/views/questions/QuestionList.vue')
      },
      {
        path: 'questions/create',
        name: 'QuestionCreate',
        component: () => import('@/views/questions/QuestionCreate.vue')
      },
      {
        path: 'questions/:id',
        name: 'QuestionDetail',
        component: () => import('@/views/questions/QuestionDetail.vue')
      },
      {
        path: 'questions/:id/edit',
        name: 'QuestionEdit',
        component: () => import('@/views/questions/QuestionEdit.vue')
      },
      {
        path: 'questions/import',
        name: 'QuestionImport',
        component: () => import('@/views/questions/QuestionImport.vue')
      },
      {
        path: 'categories',
        name: 'CategoryManage',
        component: () => import('@/views/questions/CategoryManage.vue')
      },
      // 组卷答题
      {
        path: 'exam/create',
        name: 'ExamCreate',
        component: () => import('@/views/exam/ExamCreate.vue')
      },
      {
        path: 'exam/:id',
        name: 'ExamTaking',
        component: () => import('@/views/exam/ExamTaking.vue')
      },
      {
        path: 'exam/:id/result',
        name: 'ExamResult',
        component: () => import('@/views/exam/ExamResult.vue')
      },
      {
        path: 'exam/history',
        name: 'ExamHistory',
        component: () => import('@/views/exam/ExamHistory.vue')
      },
      // 学习追踪
      {
        path: 'wrong-questions',
        name: 'WrongQuestions',
        component: () => import('@/views/learning/WrongQuestions.vue')
      },
      {
        path: 'statistics',
        name: 'Statistics',
        component: () => import('@/views/learning/Statistics.vue')
      },
      // 系统设置
      {
        path: 'settings',
        name: 'Settings',
        component: () => import('@/views/settings/Settings.vue')
      }
    ]
  },
  {
    path: '/:pathMatch(.*)*',
    redirect: '/'
  }
]

const router = createRouter({
  history: createWebHistory(),
  routes
})

// 路由守卫
router.beforeEach((to, from, next) => {
  const token = localStorage.getItem('token')
  if (to.meta.requiresAuth && !token) {
    next('/login')
  } else {
    next()
  }
})

export default router
```

### 6.3 页面布局设计

#### 6.3.1 主布局 (MainLayout.vue)

```
┌─────────────────────────────────────────────────────────────────────────┐
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                         Header                                   │   │
│  │  🎓 智能答题学习系统                              [退出登录]     │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│  ┌────────────┬────────────────────────────────────────────────────┐   │
│  │            │                                                     │   │
│  │  Sidebar   │                    Content                          │   │
│  │            │                                                     │   │
│  │  🏠 首页    │                                                     │   │
│  │            │                                                     │   │
│  │  📚 题库    │                                                     │   │
│  │   ├ 题目列表│                                                     │   │
│  │   ├ 分类管理│                                                     │   │
│  │   └ 导入题目│                                                     │   │
│  │            │                                                     │   │
│  │  📝 答题    │                                                     │   │
│  │   ├ 开始答题│                                                     │   │
│  │   └ 答题历史│                                                     │   │
│  │            │                                                     │   │
│  │  📊 学习    │                                                     │   │
│  │   ├ 错题本  │                                                     │   │
│  │   └ 统计    │                                                     │   │
│  │            │                                                     │   │
│  │  ⚙️ 设置   │                                                     │   │
│  │            │                                                     │   │
│  └────────────┴────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 6.3.2 响应式设计断点

```css
/* Tailwind CSS 断点 */
/* sm: 640px, md: 768px, lg: 1024px, xl: 1280px, 2xl: 1536px */

/* 移动端：侧边栏变为底部导航或抽屉 */
@media (max-width: 768px) {
  .sidebar { display: none; }
  .mobile-nav { display: flex; }
}
```

### 6.4 核心页面原型

#### 6.4.1 登录页 (Login.vue)

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                          │
│                                                                          │
│                         ┌───────────────────────┐                        │
│                         │                       │                        │
│                         │    🎓 智能答题学习系统 │                        │
│                         │                       │                        │
│                         │  ┌─────────────────┐  │                        │
│                         │  │ 请输入管理员密码 │  │                        │
│                         │  │ ················ │  │                        │
│                         │  └─────────────────┘  │                        │
│                         │                       │                        │
│                         │  ┌─────────────────┐  │                        │
│                         │  │      登 录      │  │                        │
│                         │  └─────────────────┘  │                        │
│                         │                       │                        │
│                         └───────────────────────┘                        │
│                                                                          │
│                              首次使用？设置密码                           │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 6.4.2 首页仪表盘 (Dashboard.vue)

```
┌─────────────────────────────────────────────────────────────────────────┐
│  📊 学习概览                                                   2024-01-20│
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐    │
│  │  📚 题库总数  │ │  ✅ 今日答题  │ │  📈 正确率   │ │  🔥 连续学习  │    │
│  │              │ │              │ │              │ │              │    │
│  │     256      │ │      30      │ │    78.4%     │ │    7 天      │    │
│  │  待补全: 76   │ │  正确: 25    │ │  较昨日 +2%  │ │              │    │
│  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘    │
│                                                                          │
│  ┌────────────────────────────────┐ ┌────────────────────────────────┐  │
│  │  🚀 快速开始                    │ │  📋 待处理任务                  │  │
│  │                                │ │                                │  │
│  │  ┌────────────────────────┐   │ │  ⚠️ 76道题目待补全答案/解析     │  │
│  │  │   [📝 开始随机答题]     │   │ │     [批量AI补全]               │  │
│  │  └────────────────────────┘   │ │                                │  │
│  │                                │ │  🤖 批量补全任务进行中          │  │
│  │  ┌────────────────────────┐   │ │     已完成 23/50  [查看]       │  │
│  │  │   [⚙️ 自定义组卷]       │   │ │                                │  │
│  │  └────────────────────────┘   │ │  ❌ 65道错题待复习              │  │
│  │                                │ │     [进入错题本]               │  │
│  │  ┌────────────────────────┐   │ │                                │  │
│  │  │   [❌ 错题重做]         │   │ │                                │  │
│  │  └────────────────────────┘   │ │                                │  │
│  └────────────────────────────────┘ └────────────────────────────────┘  │
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │  📈 近7日学习曲线                                                   │ │
│  │                                                                     │ │
│  │       45 ┤                              ╭─╮                         │ │
│  │       30 ┤              ╭─╮    ╭─╮    ╭─╯ ╰─╮                       │ │
│  │       15 ┤    ╭─╮    ╭─╯ ╰─╮╭─╯ ╰─╮╭─╯      │                       │ │
│  │        0 ┼────┴─┴────┴─────┴┴─────┴┴────────┴───                    │ │
│  │          1/14  1/15  1/16  1/17  1/18  1/19  1/20                   │ │
│  │                                                                     │ │
│  │       ── 答题数    ── 正确数                                        │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │  🕐 最近答题记录                                                    │ │
│  │                                                                     │ │
│  │  │ 试卷标题              │ 得分     │ 正确率  │ 时间       │ 操作  │ │
│  │  ├───────────────────────┼──────────┼─────────┼────────────┼───────│ │
│  │  │ 计算机网络随机测试     │ 85/100   │ 85%     │ 今天 10:45 │ 查看  │ │
│  │  │ 数据结构专项练习       │ 72/100   │ 72%     │ 昨天 15:30 │ 查看  │ │
│  │  │ 错题重做              │ 90/100   │ 90%     │ 昨天 10:00 │ 查看  │ │
│  │  └───────────────────────┴──────────┴─────────┴────────────┴───────│ │
│  │                                                   [查看全部历史 →]  │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 6.4.3 题目列表页 (QuestionList.vue)

```
┌─────────────────────────────────────────────────────────────────────────┐
│  📚 题库管理                                                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │  🔍 搜索: [请输入关键词搜索题目...                    ] [搜索]     │ │
│  │                                                                     │ │
│  │  筛选: [全部分类 ▼] [全部题型 ▼] [全部难度 ▼] [全部状态 ▼] [重置]  │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │  统计: 共 256 题 │ 完整 150 │ 有答案 30 │ 待补全 76                 │ │
│  │                                                                     │ │
│  │  ☐ 全选    [+ 添加题目] [📥 导入] [📤 导出] [🤖 批量AI补全] [🗑 删除]│ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │                                                                     │ │
│  │  ☐ ┌─────────────────────────────────────────────────────────────┐ │ │
│  │    │  1. HTTP状态码200表示什么？                              #q01 │ │ │
│  │    │                                                              │ │ │
│  │    │  单选题 │ 简单 │ 计算机网络 │ HTTP, 状态码                    │ │ │
│  │    │  ✅答案:已确认  ✅解析:已确认                                 │ │ │
│  │    │                                                              │ │ │
│  │    │  A. 请求成功  B. 重定向  C. 客户端错误  D. 服务器错误         │ │ │
│  │    │                                          [编辑] [删除]       │ │ │
│  │    └─────────────────────────────────────────────────────────────┘ │ │
│  │                                                                     │ │
│  │  ☐ ┌─────────────────────────────────────────────────────────────┐ │ │
│  │    │  2. TCP三次握手的第一步是？                              #q02 │ │ │
│  │    │                                                              │ │ │
│  │    │  单选题 │ 中等 │ 计算机网络 │ TCP, 网络协议                   │ │ │
│  │    │  ⚠️答案:待补全  ⚠️解析:待补全                                 │ │ │
│  │    │                                                              │ │ │
│  │    │  A. SYN  B. ACK  C. FIN  D. RST                              │ │ │
│  │    │                              [🤖 AI补全] [编辑] [删除]       │ │ │
│  │    └─────────────────────────────────────────────────────────────┘ │ │
│  │                                                                     │ │
│  │  ☐ ┌─────────────────────────────────────────────────────────────┐ │ │
│  │    │  3. 以下哪些是TCP的特点？                                #q03 │ │ │
│  │    │                                                              │ │ │
│  │    │  多选题 │ 中等 │ 计算机网络                                   │ │ │
│  │    │  🤖答案:AI生成  ⚠️解析:待补全                   [确认答案]    │ │ │
│  │    │                                                              │ │ │
│  │    │  A. 面向连接  B. 无连接  C. 可靠传输  D. 不可靠传输          │ │ │
│  │    │                              [🤖 AI补全] [编辑] [删除]       │ │ │
│  │    └─────────────────────────────────────────────────────────────┘ │ │
│  │                                                                     │ │
│  │  ...更多题目...                                                     │ │
│  │                                                                     │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │         [<]  1  2  3  4  5  ...  13  [>]        共256条 每页20条   │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 6.4.4 AI补全弹窗 (AICompleteModal.vue)

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                     [×] │
│  🤖 AI补全答案与解析                                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  📝 题目内容                                                             │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │  TCP三次握手的第一步是？                                            │ │
│  │                                                                     │ │
│  │  A. SYN    B. ACK    C. FIN    D. RST                              │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ✨ AI生成结果                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │                                                                     │ │
│  │  🅰️ 答案                                                           │ │
│  │  ┌──────────────────────────────────────────────────────────────┐  │ │
│  │  │  A                                                 [编辑]    │  │ │
│  │  └──────────────────────────────────────────────────────────────┘  │ │
│  │                                                                     │ │
│  │  📖 解析                                                           │ │
│  │  ┌──────────────────────────────────────────────────────────────┐  │ │
│  │  │  TCP三次握手（Three-way Handshake）是TCP协议建立连接的过程。  │  │ │
│  │  │                                                              │  │ │
│  │  │  **三次握手过程：**                                           │  │ │
│  │  │                                                              │  │ │
│  │  │  1. **第一次握手**：客户端发送SYN包（SYN=1，seq=x）到服务器   │  │ │
│  │  │  2. **第二次握手**：服务器收到后，回复SYN+ACK包               │  │ │
│  │  │  3. **第三次握手**：客户端收到后，发送ACK包确认               │  │ │
│  │  │                                                              │  │ │
│  │  │  因此第一步是客户端发送SYN包，答案选A。                       │  │ │
│  │  │                                                    [编辑]    │  │ │
│  │  └──────────────────────────────────────────────────────────────┘  │ │
│  │                                                                     │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │      [🔄 重新生成]         [取消]         [✅ 确认并保存]          │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 6.4.5 题目导入页 (QuestionImport.vue)

```
┌─────────────────────────────────────────────────────────────────────────┐
│  📥 导入题目                                                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │  📁 上传文件                                                        │ │
│  │  ┌──────────────────────────────────────────────────────────────┐  │ │
│  │  │                                                              │  │ │
│  │  │         ┌─────────────────────────────────┐                  │  │ │
│  │  │         │  📄                              │                  │  │ │
│  │  │         │                                 │                  │  │ │
│  │  │         │  点击或拖拽文件到此处上传        │                  │  │ │
│  │  │         │                                 │                  │  │ │
│  │  │         │  支持 .docx .xlsx .csv .txt .json│                  │  │ │
│  │  │         └─────────────────────────────────┘                  │  │ │
│  │  │                                                              │  │ │
│  │  └──────────────────────────────────────────────────────────────┘  │ │
│  │                                                                     │ │
│  │  已选择: 计算机网络题库.docx (125KB)                      [清除]   │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │  📋 解析预览                                              [预览]   │ │
│  │  ┌──────────────────────────────────────────────────────────────┐  │ │
│  │  │                                                              │  │ │
│  │  │  ✅ 成功解析 48 道题目                                       │  │ │
│  │  │  ⚠️  2 道题目格式异常                                        │  │ │
│  │  │                                                              │  │ │
│  │  │  ┌─────────────────────────────────────────────────────────┐ │  │ │
│  │  │  │ 类型     │ 数量 │ 完整 │ 有答案 │ 仅题干 │               │ │  │ │
│  │  │  ├──────────┼──────┼──────┼────────┼────────┤               │ │  │ │
│  │  │  │ 单选题   │  25  │  5   │   10   │   10   │               │ │  │ │
│  │  │  │ 多选题   │  10  │  2   │   3    │   5    │               │ │  │ │
│  │  │  │ 判断题   │  10  │  3   │   5    │   2    │               │ │  │ │
│  │  │  │ 简述题   │  3   │  0   │   0    │   3    │               │ │  │ │
│  │  │  │ 未识别   │  2   │  -   │   -    │   -    │               │ │  │ │
│  │  │  └──────────┴──────┴──────┴────────┴────────┘               │ │  │ │
│  │  │                                                              │  │ │
│  │  │  💡 不完整的题目导入后，可在题库中使用AI补全答案和解析        │  │ │
│  │  │                                                              │  │ │
│  │  └──────────────────────────────────────────────────────────────┘  │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │  ⚙️ 导入设置                                                       │ │
│  │                                                                     │ │
│  │  目标分类:  [计算机网络          ▼]                                │ │
│  │  默认难度:  [中等               ▼]                                 │ │
│  │  默认题型:  [单选题（无法识别时）▼]                                │ │
│  │                                                                     │ │
│  │  ☐  导入后自动调用AI补全答案和解析（后台处理）                      │ │
│  │  ☑  跳过格式错误的题目继续导入                                     │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │                     [取消]              [确认导入 48 道题目]       │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 6.4.6 创建试卷页 (ExamCreate.vue)

```
┌─────────────────────────────────────────────────────────────────────────┐
│  📝 创建试卷                                                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ⚡ 快速组卷                                                             │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │                                                                     │ │
│  │   [🎲 随机20题]   [🎲 随机50题]   [🎲 随机100题]   [❌ 全部错题]   │ │
│  │                                                                     │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ────────────────────────── 或 自定义组卷 ──────────────────────────── │
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │  📋 基本设置                                                        │ │
│  │                                                                     │ │
│  │  试卷标题:  [计算机网络随机测试                           ]        │ │
│  │                                                                     │ │
│  │  答题模式:  ◉ 考试模式（计时，交卷后显示结果）                      │ │
│  │            ○ 练习模式（即时显示答案解析）                          │ │
│  │            ○ 背题模式（直接显示题目+答案+解析）                    │ │
│  │                                                                     │ │
│  │  时间限制:  [60    ] 分钟   ☐ 不限时                               │ │
│  │                                                                     │ │
│  │  题目范围:  ☑ 全部分类                                              │ │
│  │            ☐ 指定分类: [计算机网络] [数据结构] [+添加]             │ │
│  │                                                                     │ │
│  │  其他选项:  ☑ 打乱选项顺序                                          │ │
│  │            ☑ 仅使用已确认的题目                                    │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │  📊 题型配置                                                        │ │
│  │                                                                     │ │
│  │  ┌─────────────────────────────────────────────────────────────┐   │ │
│  │  │ 题型     │ 数量  │ 每题分值 │ 难度      │ 可用  │ 操作     │   │ │
│  │  ├──────────┼───────┼──────────┼───────────┼───────┼──────────┤   │ │
│  │  │ 单选题   │ [20]  │ [2  ]分  │ [混合 ▼]  │ 120   │  [×]     │   │ │
│  │  │ 多选题   │ [10]  │ [3  ]分  │ [中等 ▼]  │ 60    │  [×]     │   │ │
│  │  │ 判断题   │ [10]  │ [1  ]分  │ [简单 ▼]  │ 50    │  [×]     │   │ │
│  │  │ 简述题   │ [2 ]  │ [10 ]分  │ [混合 ▼]  │ 26    │  [×]     │   │ │
│  │  └──────────┴───────┴──────────┴───────────┴───────┴──────────┘   │ │
│  │                                                                     │ │
│  │                              [+ 添加题型]                           │ │
│  │                                                                     │ │
│  │  ─────────────────────────────────────────────────────────────────  │ │
│  │  📈 试卷概要:  共 42 题  │  总分 100 分  │  预计时长 60 分钟        │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │                      [取消]              [🚀 生成试卷并开始答题]    │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 6.4.7 答题页面 (ExamTaking.vue)

```
┌─────────────────────────────────────────────────────────────────────────┐
│  📝 计算机网络随机测试                              ⏱️ 剩余 45:32  [暂存]│
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌───────────────────────────────────────────────────────────┬────────┐ │
│  │                                                           │        │ │
│  │  ┌───────────────────────────────────────────────────┐   │ 答题卡 │ │
│  │  │  第 5 题 / 共 42 题                    单选题 (2分) │   │        │ │
│  │  └───────────────────────────────────────────────────┘   │ ┌────┐ │ │
│  │                                                           │ │1 ●│ │ │
│  │  ┌───────────────────────────────────────────────────┐   │ │2 ●│ │ │
│  │  │                                                    │   │ │3 ●│ │ │
│  │  │  HTTP状态码200表示什么？                           │   │ │4 ●│ │ │
│  │  │                                                    │   │ │5 ○│ │ │
│  │  └───────────────────────────────────────────────────┘   │ │6 ○│ │ │
│  │                                                           │ │7 ○│ │ │
│  │  ┌───────────────────────────────────────────────────┐   │ │...│ │ │
│  │  │                                                    │   │ │41○│ │ │
│  │  │  ○  A. 请求成功                                    │   │ │42○│ │ │
│  │  │                                                    │   │ └────┘ │ │
│  │  │  ○  B. 重定向                                      │   │        │ │
│  │  │                                                    │   │ ● 已答 │ │
│  │  │  ○  C. 客户端错误                                  │   │ ○ 未答 │ │
│  │  │                                                    │   │        │ │
│  │  │  ○  D. 服务器错误                                  │   │ ─────  │ │
│  │  │                                                    │   │        │ │
│  │  └───────────────────────────────────────────────────┘   │ 已答4题 │ │
│  │                                                           │ 未答38题│ │
│  │                                                           │        │ │
│  │  ┌───────────────────────────────────────────────────┐   │        │ │
│  │  │    [← 上一题]                        [下一题 →]    │   │        │ │
│  │  └───────────────────────────────────────────────────┘   │        │ │
│  │                                                           │ ─────  │ │
│  │                                                           │        │ │
│  │                                                           │[交卷]  │ │
│  │                                                           │        │ │
│  └───────────────────────────────────────────────────────────┴────────┘ │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘

【练习模式 - 显示答案解析】
┌─────────────────────────────────────────────────────────────────────────┐
│  ...题目和选项同上...                                                    │
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │  ✅ 正确答案: A                                                     │ │
│  │                                                                     │ │
│  │  📖 解析:                                                           │ │
│  │  HTTP状态码200表示请求成功。                                        │ │
│  │                                                                     │ │
│  │  HTTP状态码分类：                                                   │ │
│  │  • 1xx - 信息性响应                                                │ │
│  │  • 2xx - 成功（200 OK, 201 Created...）                            │ │
│  │  • 3xx - 重定向（301, 302, 304...）                                │ │
│  │  • 4xx - 客户端错误（400, 401, 404...）                            │ │
│  │  • 5xx - 服务器错误（500, 502, 503...）                            │ │
│  │                                                       [🤖 追问]    │ │
│  └────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 6.4.8 答题结果页 (ExamResult.vue)

```
┌─────────────────────────────────────────────────────────────────────────┐
│  📊 答题结果 - 计算机网络随机测试                                        │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │                           🎉 答题完成！                             │ │
│  │                                                                     │ │
│  │       ┌─────────────────────────────────────────────────┐          │ │
│  │       │                                                 │          │ │
│  │       │                    85 分                        │          │ │
│  │       │                   ─────                         │          │ │
│  │       │                   100 分                        │          │ │
│  │       │                                                 │          │ │
│  │       └─────────────────────────────────────────────────┘          │ │
│  │                                                                     │ │
│  │    ✅ 正确 35题        ❌ 错误 7题        ⏱️ 用时 45:32            │ │
│  │                                                                     │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │  🤖 AI学习分析报告                               [生成分析报告]    │ │
│  │  ─────────────────────────────────────────────────────────────────  │ │
│  │                                                                     │ │
│  │  ⏳ 点击上方按钮生成AI分析报告，获取个性化学习建议                  │ │
│  │                                                                     │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │  📋 答题详情                                     [仅显示错题 ☐]    │ │
│  │                                                                     │ │
│  │  ┌──────────────────────────────────────────────────────────────┐  │ │
│  │  │  ✅ 第1题 (2分)                                       单选题  │  │ │
│  │  │                                                              │  │ │
│  │  │  HTTP状态码200表示什么？                                     │  │ │
│  │  │  A.请求成功 B.重定向 C.客户端错误 D.服务器错误               │  │ │
│  │  │                                                              │  │ │
│  │  │  你的答案: A ✓    正确答案: A                                │  │ │
│  │  │                                              [查看解析 ▼]    │  │ │
│  │  └──────────────────────────────────────────────────────────────┘  │ │
│  │                                                                     │ │
│  │  ┌──────────────────────────────────────────────────────────────┐  │ │
│  │  │  ❌ 第5题 (2分)                              单选题 [加入错题本]│  │ │
│  │  │                                                              │  │ │
│  │  │  TCP三次握手的第一步是？                                     │  │ │
│  │  │  A.SYN  B.ACK  C.FIN  D.RST                                  │  │ │
│  │  │                                                              │  │ │
│  │  │  你的答案: B ✗    正确答案: A                                │  │ │
│  │  │                                                              │  │ │
│  │  │  📖 解析:                                                    │  │ │
│  │  │  TCP三次握手第一步是客户端发送SYN包...                       │  │ │
│  │  │                                                 [🤖 追问]    │  │ │
│  │  └──────────────────────────────────────────────────────────────┘  │ │
│  │                                                                     │ │
│  │  ... 更多题目 ...                                                   │ │
│  │                                                                     │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │      [返回首页]        [重做错题]        [再来一套]                │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 6.4.9 AI分析报告弹窗 (AIReportModal.vue)

```
┌─────────────────────────────────────────────────────────────────────────┐
│  📊 AI学习分析报告                                                  [×] │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │                                                                     │ │
│  │  ## 📊 学习分析报告                                                 │ │
│  │                                                                     │ │
│  │  ### 一、答题概况                                                   │ │
│  │                                                                     │ │
│  │  | 指标     | 数值           |                                      │ │
│  │  |----------|----------------|                                      │ │
│  │  | 总题数   | 42道           |                                      │ │
│  │  | 正确数   | 35道           |                                      │ │
│  │  | 错误数   | 7道            |                                      │ │
│  │  | 正确率   | 83.3%          |                                      │ │
│  │  | 用时     | 45分32秒       |                                      │ │
│  │                                                                     │ │
│  │  ### 二、错题知识点分布                                             │ │
│  │                                                                     │ │
│  │  | 知识点      | 错题数 | 占比  |                                   │ │
│  │  |-------------|--------|-------|                                   │ │
│  │  | TCP/IP协议  | 3      | 43%   |                                   │ │
│  │  | HTTP协议    | 2      | 29%   |                                   │ │
│  │  | 数据库索引  | 2      | 28%   |                                   │ │
│  │                                                                     │ │
│  │  ### 三、薄弱点详细分析                                             │ │
│  │                                                                     │ │
│  │  #### 1. TCP/IP协议 (重点关注 ⚠️)                                   │ │
│  │                                                                     │ │
│  │  你在TCP三次握手和四次挥手相关题目上存在理解偏差。                  │ │
│  │                                                                     │ │
│  │  **常见误区：**                                                     │ │
│  │  - 混淆了SYN和ACK的作用                                            │ │
│  │  - 对连接建立的顺序理解不清晰                                      │ │
│  │                                                                     │ │
│  │  **建议复习：**                                                     │ │
│  │  - TCP连接建立与释放过程                                           │ │
│  │  - 各标志位（SYN/ACK/FIN）的含义                                   │ │
│  │                                                                     │ │
│  │  #### 2. HTTP协议                                                   │ │
│  │  ...                                                                │ │
│  │                                                                     │ │
│  │  ### 四、学习建议                                                   │ │
│  │                                                                     │ │
│  │  1. 🎯 **优先复习TCP/IP协议**，这是本次测试的主要失分点            │ │
│  │  2. 📚 建议刷20道网络协议专项练习题                                │ │
│  │  3. 💪 整体表现良好，正确率达到83%，继续保持！                     │ │
│  │                                                                     │ │
│  │  ---                                                                │ │
│  │  *报告生成时间: 2024-01-20 11:00:00*                               │ │
│  │                                                                     │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │              [导出报告]                    [关闭]                  │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 6.4.10 系统设置页 (Settings.vue)

```
┌─────────────────────────────────────────────────────────────────────────┐
│  ⚙️ 系统设置                                                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │  🤖 AI配置                                                          │ │
│  │                                                                     │ │
│  │  API地址:   [https://api.openai.com/v1                      ]      │ │
│  │                                                                     │ │
│  │  API密钥:   [sk-xxxx************************xxxx            ] 👁   │ │
│  │                                                                     │ │
│  │  模型名称:  [gpt-4o-mini                                    ]      │ │
│  │                                                                     │ │
│  │  最大Token: [2000      ]       温度参数: [0.7     ]                │ │
│  │                                                                     │ │
│  │                                    [🔗 测试连接]   状态: ✅ 已连接  │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │  🔐 安全设置                                                        │ │
│  │                                                                     │ │
│  │  修改密码:                                                          │ │
│  │  原密码:    [                                                ]     │ │
│  │  新密码:    [                                                ]     │ │
│  │  确认密码:  [                                                ]     │ │
│  │                                                   [修改密码]       │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │  📝 答题设置                                                        │ │
│  │                                                                     │ │
│  │  默认考试时间:  [60    ] 分钟                                       │ │
│  │  自动收集错题:  ☑ 开启                                              │ │
│  │  网站标题:      [智能答题学习系统                           ]      │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │  💾 数据管理                                                        │ │
│  │                                                                     │ │
│  │  数据库大小: 15.6 MB                                                │ │
│  │  题目数量:   256 道                                                 │ │
│  │  考试记录:   45 条                                                  │ │
│  │                                                                     │ │
│  │  [📥 备份数据]    [📤 恢复数据]                                     │ │
│  │                                                                     │ │
│  │  ⚠️ 恢复数据将覆盖当前所有数据，请谨慎操作                          │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │  ℹ️ 关于                                                            │ │
│  │                                                                     │ │
│  │  系统版本: v1.0.0                                                   │ │
│  │  项目地址: https://github.com/xxx/quiz-learning-system             │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │                                              [保存设置]            │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 7. AI模块设计

### 7.1 AI服务架构

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           AI服务架构                                     │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │                          AI Service                                 │ │
│  │  ┌──────────────────────────────────────────────────────────────┐  │ │
│  │  │                      AI Client                                │  │ │
│  │  │                  (OpenAI Compatible)                          │  │ │
│  │  │                                                               │  │ │
│  │  │   支持: OpenAI / DeepSeek / Claude / 本地模型 / 其他兼容API   │  │ │
│  │  └──────────────────────────────────────────────────────────────┘  │ │
│  │                              │                                      │ │
│  │           ┌──────────────────┼──────────────────┐                  │ │
│  │           ▼                  ▼                  ▼                  │ │
│  │  ┌──────────────┐   ┌──────────────┐   ┌──────────────┐           │ │
│  │  │ 答案生成器    │   │ 解析生成器    │   │ 报告生成器    │           │ │
│  │  │              │   │              │   │              │           │ │
│  │  │ generate_    │   │ generate_    │   │ generate_    │           │ │
│  │  │ answer()     │   │ explanation()│   │ report()     │           │ │
│  │  └──────────────┘   └──────────────┘   └──────────────┘           │ │
│  │           │                  │                  │                  │ │
│  │           └──────────────────┼──────────────────┘                  │ │
│  │                              ▼                                      │ │
│  │  ┌──────────────────────────────────────────────────────────────┐  │ │
│  │  │                    Prompt Manager                             │  │ │
│  │  │                                                               │  │ │
│  │  │   • 答案生成 Prompt                                           │  │ │
│  │  │   • 解析生成 Prompt                                           │  │ │
│  │  │   • 学习报告 Prompt                                           │  │ │
│  │  │   • 知识点解释 Prompt                                         │  │ │
│  │  └──────────────────────────────────────────────────────────────┘  │ │
│  │                              │                                      │ │
│  │                              ▼                                      │ │
│  │  ┌──────────────────────────────────────────────────────────────┐  │ │
│  │  │                    Task Manager                               │  │ │
│  │  │                                                               │  │ │
│  │  │   • 批量任务队列                                              │  │ │
│  │  │   • 任务状态管理                                              │  │ │
│  │  │   • 暂停/恢复/取消                                            │  │ │
│  │  │   • 进度追踪                                                  │  │ │
│  │  └──────────────────────────────────────────────────────────────┘  │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 7.2 Prompt设计

#### 7.2.1 答案生成Prompt

```python
# services/prompts.py

ANSWER_GENERATION_PROMPT = """
你是一位专业的学科教师，请根据以下题目生成正确答案。

## 题目信息
- 题型：{question_type}
- 题干：{content}
{options_text}

## 输出要求
请直接给出答案，格式如下：

【单选题】直接输出选项字母，如：A
【多选题】输出所有正确选项字母，按顺序排列，如：ACD
【判断题】输出"正确"或"错误"
【简述题】简洁准确地回答问题，控制在200字以内

## 答案
"""

def build_answer_prompt(question: dict) -> str:
    options_text = ""
    if question.get("options"):
        options = question["options"]
        options_text = "- 选项：\n"
        for key, value in options.items():
            options_text += f"  {key}. {value}\n"
    
    type_map = {
        "single": "单选题",
        "multiple": "多选题", 
        "judge": "判断题",
        "essay": "简述题"
    }
    
    return ANSWER_GENERATION_PROMPT.format(
        question_type=type_map.get(question["type"], "未知"),
        content=question["content"],
        options_text=options_text
    )
```


#### 7.2.2 解析生成Prompt

```python
EXPLANATION_GENERATION_PROMPT = """
你是一位专业的学科教师，请根据以下题目和答案生成详细解析。

## 题目信息
- 题型：{question_type}
- 题干：{content}
{options_text}
- 正确答案：{answer}

## 输出要求
请生成清晰、专业的解析，要求：
1. 首先解释为什么正确答案是对的
2. 如果是选择题，简要说明其他选项为什么不对
3. 补充相关知识点，帮助理解和记忆
4. 使用Markdown格式，可使用列表、加粗等
5. 控制在300字以内，简洁明了

## 解析
"""

def build_explanation_prompt(question: dict) -> str:
    options_text = ""
    if question.get("options"):
        options = question["options"]
        options_text = "- 选项：\n"
        for key, value in options.items():
            options_text += f"  {key}. {value}\n"
    
    type_map = {
        "single": "单选题",
        "multiple": "多选题",
        "judge": "判断题",
        "essay": "简述题"
    }
    
    return EXPLANATION_GENERATION_PROMPT.format(
        question_type=type_map.get(question["type"], "未知"),
        content=question["content"],
        options_text=options_text,
        answer=question.get("answer", "未知")
    )
```

#### 7.2.3 答案+解析同时生成Prompt

```python
ANSWER_AND_EXPLANATION_PROMPT = """
你是一位专业的学科教师，请根据以下题目生成正确答案和详细解析。

## 题目信息
- 题型：{question_type}
- 题干：{content}
{options_text}

## 输出要求
请严格按照以下JSON格式输出，不要输出其他内容：

```json
{{
    "answer": "答案内容",
    "explanation": "解析内容（支持Markdown格式）"
}}
```

### 答案格式说明
- 单选题：直接输出选项字母，如 "A"
- 多选题：输出所有正确选项字母，如 "ACD"
- 判断题：输出 "正确" 或 "错误"
- 简述题：简洁准确的答案文本

### 解析要求
1. 解释正确答案的原因
2. 选择题需说明其他选项的问题
3. 补充相关知识点
4. 控制在300字以内

请输出JSON：
"""

def build_complete_prompt(question: dict) -> str:
    options_text = ""
    if question.get("options"):
        options = question["options"]
        options_text = "- 选项：\n"
        for key, value in options.items():
            options_text += f"  {key}. {value}\n"
    
    type_map = {
        "single": "单选题",
        "multiple": "多选题",
        "judge": "判断题",
        "essay": "简述题"
    }
    
    return ANSWER_AND_EXPLANATION_PROMPT.format(
        question_type=type_map.get(question["type"], "未知"),
        content=question["content"],
        options_text=options_text
    )
```

#### 7.2.4 学习分析报告Prompt

```python
LEARNING_REPORT_PROMPT = """
你是一位专业的学习分析师，请根据以下答题数据生成详细的学习分析报告。

## 答题概况
- 试卷标题：{exam_title}
- 总题数：{total_count}
- 正确数：{correct_count}
- 错误数：{wrong_count}
- 正确率：{correct_rate}%
- 用时：{time_spent}

## 错题详情
{wrong_questions_detail}

## 输出要求
请生成一份Markdown格式的学习分析报告，包含以下部分：

### 报告结构

1. **答题概况**
   - 用表格展示基本统计数据
   - 给出整体评价

2. **错题知识点分布**
   - 用表格统计各知识点的错题数量
   - 按错误数量降序排列

3. **薄弱点详细分析**
   - 针对每个主要薄弱点：
     - 分析错误原因
     - 指出常见误区
     - 给出正确理解方式

4. **学习建议**
   - 给出3-5条具体可执行的学习建议
   - 按优先级排序
   - 包含鼓励性总结

请确保报告：
- 使用清晰的Markdown格式
- 分析具体、有针对性
- 建议实用、可操作
- 语气积极、鼓励性

## 分析报告
"""

def build_report_prompt(exam_data: dict) -> str:
    # 构建错题详情文本
    wrong_details = ""
    for i, q in enumerate(exam_data.get("wrong_questions", []), 1):
        wrong_details += f"""
### 错题{i}
- 题目：{q['content']}
- 题型：{q['type']}
- 正确答案：{q['answer']}
- 用户答案：{q['user_answer']}
- 知识点：{', '.join(q.get('tags', ['未分类']))}
- 分类：{q.get('category_name', '未分类')}
"""
    
    # 计算用时
    time_spent = exam_data.get("time_spent", 0)
    minutes = time_spent // 60
    seconds = time_spent % 60
    time_str = f"{minutes}分{seconds}秒"
    
    return LEARNING_REPORT_PROMPT.format(
        exam_title=exam_data.get("title", "未命名试卷"),
        total_count=exam_data.get("total_count", 0),
        correct_count=exam_data.get("correct_count", 0),
        wrong_count=exam_data.get("wrong_count", 0),
        correct_rate=round(exam_data.get("correct_rate", 0) * 100, 1),
        time_spent=time_str,
        wrong_questions_detail=wrong_details if wrong_details else "无错题"
    )
```

#### 7.2.5 知识点追问Prompt

```python
EXPLAIN_PROMPT = """
你是一位耐心的学科教师，学生正在学习以下题目，并提出了问题，请给予解答。

## 题目信息
- 题干：{content}
{options_text}
- 正确答案：{answer}
- 题目解析：{explanation}

## 学生问题
{query}

## 回答要求
1. 直接回答学生的问题
2. 使用通俗易懂的语言
3. 可以举例说明
4. 如果涉及知识点扩展，适当补充
5. 控制在400字以内

## 回答
"""

def build_explain_prompt(question: dict, query: str) -> str:
    options_text = ""
    if question.get("options"):
        options = question["options"]
        options_text = "- 选项：\n"
        for key, value in options.items():
            options_text += f"  {key}. {value}\n"
    
    return EXPLAIN_PROMPT.format(
        content=question["content"],
        options_text=options_text,
        answer=question.get("answer", "未知"),
        explanation=question.get("explanation", "暂无解析"),
        query=query
    )
```

### 7.3 AI服务实现

```python
# services/ai_service.py

import json
import asyncio
from typing import Optional, AsyncGenerator
from openai import AsyncOpenAI
from .prompts import (
    build_answer_prompt,
    build_explanation_prompt,
    build_complete_prompt,
    build_report_prompt,
    build_explain_prompt
)

class AIService:
    def __init__(self, api_url: str, api_key: str, model: str, 
                 max_tokens: int = 2000, temperature: float = 0.7):
        self.client = AsyncOpenAI(
            base_url=api_url,
            api_key=api_key
        )
        self.model = model
        self.max_tokens = max_tokens
        self.temperature = temperature
    
    async def generate_answer(self, question: dict) -> str:
        """生成答案"""
        prompt = build_answer_prompt(question)
        response = await self.client.chat.completions.create(
            model=self.model,
            messages=[{"role": "user", "content": prompt}],
            max_tokens=100,
            temperature=0.3  # 答案生成用低温度
        )
        return response.choices[0].message.content.strip()
    
    async def generate_explanation(self, question: dict) -> str:
        """生成解析"""
        prompt = build_explanation_prompt(question)
        response = await self.client.chat.completions.create(
            model=self.model,
            messages=[{"role": "user", "content": prompt}],
            max_tokens=self.max_tokens,
            temperature=self.temperature
        )
        return response.choices[0].message.content.strip()
    
    async def generate_complete(self, question: dict) -> dict:
        """同时生成答案和解析"""
        prompt = build_complete_prompt(question)
        response = await self.client.chat.completions.create(
            model=self.model,
            messages=[{"role": "user", "content": prompt}],
            max_tokens=self.max_tokens,
            temperature=self.temperature
        )
        
        content = response.choices[0].message.content.strip()
        
        # 解析JSON响应
        try:
            # 尝试提取JSON部分
            if "```json" in content:
                json_str = content.split("```json")[1].split("```")[0]
            elif "```" in content:
                json_str = content.split("```")[1].split("```")[0]
            else:
                json_str = content
            
            result = json.loads(json_str)
            return {
                "answer": result.get("answer", ""),
                "explanation": result.get("explanation", "")
            }
        except json.JSONDecodeError:
            # 解析失败，尝试分别生成
            return {
                "answer": await self.generate_answer(question),
                "explanation": content
            }
    
    async def generate_complete_stream(self, question: dict) -> AsyncGenerator[dict, None]:
        """流式生成答案和解析"""
        prompt = build_complete_prompt(question)
        
        stream = await self.client.chat.completions.create(
            model=self.model,
            messages=[{"role": "user", "content": prompt}],
            max_tokens=self.max_tokens,
            temperature=self.temperature,
            stream=True
        )
        
        full_content = ""
        async for chunk in stream:
            if chunk.choices[0].delta.content:
                content = chunk.choices[0].delta.content
                full_content += content
                yield {"type": "content", "content": content}
        
        # 解析完整内容
        try:
            if "```json" in full_content:
                json_str = full_content.split("```json")[1].split("```")[0]
            else:
                json_str = full_content
            result = json.loads(json_str)
            yield {"type": "done", "data": result}
        except:
            yield {"type": "done", "data": {"answer": "", "explanation": full_content}}
    
    async def generate_report(self, exam_data: dict) -> str:
        """生成学习分析报告"""
        prompt = build_report_prompt(exam_data)
        response = await self.client.chat.completions.create(
            model=self.model,
            messages=[{"role": "user", "content": prompt}],
            max_tokens=3000,
            temperature=0.7
        )
        return response.choices[0].message.content.strip()
    
    async def generate_report_stream(self, exam_data: dict) -> AsyncGenerator[str, None]:
        """流式生成学习分析报告"""
        prompt = build_report_prompt(exam_data)
        
        stream = await self.client.chat.completions.create(
            model=self.model,
            messages=[{"role": "user", "content": prompt}],
            max_tokens=3000,
            temperature=0.7,
            stream=True
        )
        
        async for chunk in stream:
            if chunk.choices[0].delta.content:
                yield chunk.choices[0].delta.content
    
    async def explain(self, question: dict, query: str) -> str:
        """知识点追问"""
        prompt = build_explain_prompt(question, query)
        response = await self.client.chat.completions.create(
            model=self.model,
            messages=[{"role": "user", "content": prompt}],
            max_tokens=self.max_tokens,
            temperature=self.temperature
        )
        return response.choices[0].message.content.strip()
    
    async def test_connection(self) -> dict:
        """测试API连接"""
        try:
            response = await self.client.chat.completions.create(
                model=self.model,
                messages=[{"role": "user", "content": "Hello"}],
                max_tokens=10
            )
            return {
                "success": True,
                "model": self.model,
                "message": "连接成功"
            }
        except Exception as e:
            return {
                "success": False,
                "error": str(e)
            }
```

### 7.4 批量任务管理器

```python
# services/task_manager.py

import asyncio
import uuid
from datetime import datetime
from typing import Optional, List
from enum import Enum
from dataclasses import dataclass, field

class TaskStatus(Enum):
    PENDING = "pending"
    RUNNING = "running"
    PAUSED = "paused"
    COMPLETED = "completed"
    FAILED = "failed"
    CANCELLED = "cancelled"

class TaskType(Enum):
    ANSWER = "answer"
    EXPLANATION = "explanation"
    BOTH = "both"
    REPORT = "report"

@dataclass
class AITask:
    id: str
    type: TaskType
    status: TaskStatus = TaskStatus.PENDING
    question_ids: List[str] = field(default_factory=list)
    total_count: int = 0
    completed_count: int = 0
    failed_count: int = 0
    current_question_id: Optional[str] = None
    error_message: Optional[str] = None
    created_at: datetime = field(default_factory=datetime.now)
    started_at: Optional[datetime] = None
    updated_at: datetime = field(default_factory=datetime.now)
    completed_at: Optional[datetime] = None
    
    @property
    def progress(self) -> float:
        if self.total_count == 0:
            return 0
        return self.completed_count / self.total_count

class TaskManager:
    def __init__(self, ai_service, db_session):
        self.ai_service = ai_service
        self.db = db_session
        self.tasks: dict[str, AITask] = {}
        self.running_task: Optional[str] = None
        self._pause_event = asyncio.Event()
        self._pause_event.set()  # 初始状态：未暂停
        self._cancel_flag = False
    
    async def create_task(self, task_type: TaskType, question_ids: List[str]) -> AITask:
        """创建批量任务"""
        task = AITask(
            id=str(uuid.uuid4()),
            type=task_type,
            question_ids=question_ids,
            total_count=len(question_ids)
        )
        self.tasks[task.id] = task
        
        # 保存到数据库
        await self._save_task(task)
        
        # 启动任务
        asyncio.create_task(self._run_task(task.id))
        
        return task
    
    async def _run_task(self, task_id: str):
        """执行批量任务"""
        task = self.tasks.get(task_id)
        if not task:
            return
        
        self.running_task = task_id
        task.status = TaskStatus.RUNNING
        task.started_at = datetime.now()
        await self._save_task(task)
        
        try:
            for question_id in task.question_ids:
                # 检查取消标志
                if self._cancel_flag:
                    task.status = TaskStatus.CANCELLED
                    break
                
                # 等待暂停恢复
                await self._pause_event.wait()
                
                task.current_question_id = question_id
                task.updated_at = datetime.now()
                
                try:
                    # 获取题目
                    question = await self._get_question(question_id)
                    if not question:
                        task.failed_count += 1
                        continue
                    
                    # 调用AI生成
                    if task.type == TaskType.ANSWER:
                        answer = await self.ai_service.generate_answer(question)
                        await self._update_question_answer(question_id, answer)
                    elif task.type == TaskType.EXPLANATION:
                        explanation = await self.ai_service.generate_explanation(question)
                        await self._update_question_explanation(question_id, explanation)
                    else:  # BOTH
                        result = await self.ai_service.generate_complete(question)
                        await self._update_question_complete(question_id, result)
                    
                    task.completed_count += 1
                    
                except Exception as e:
                    task.failed_count += 1
                    print(f"处理题目 {question_id} 失败: {e}")
                
                await self._save_task(task)
                
                # 添加延迟，避免API限流
                await asyncio.sleep(1)
            
            if task.status != TaskStatus.CANCELLED:
                task.status = TaskStatus.COMPLETED
            task.completed_at = datetime.now()
            
        except Exception as e:
            task.status = TaskStatus.FAILED
            task.error_message = str(e)
        
        finally:
            self.running_task = None
            self._cancel_flag = False
            await self._save_task(task)
    
    async def pause_task(self, task_id: str) -> bool:
        """暂停任务"""
        task = self.tasks.get(task_id)
        if task and task.status == TaskStatus.RUNNING:
            self._pause_event.clear()
            task.status = TaskStatus.PAUSED
            await self._save_task(task)
            return True
        return False
    
    async def resume_task(self, task_id: str) -> bool:
        """恢复任务"""
        task = self.tasks.get(task_id)
        if task and task.status == TaskStatus.PAUSED:
            task.status = TaskStatus.RUNNING
            self._pause_event.set()
            await self._save_task(task)
            return True
        return False
    
    async def cancel_task(self, task_id: str) -> bool:
        """取消任务"""
        task = self.tasks.get(task_id)
        if task and task.status in [TaskStatus.RUNNING, TaskStatus.PAUSED, TaskStatus.PENDING]:
            self._cancel_flag = True
            self._pause_event.set()  # 确保不会卡在暂停状态
            task.status = TaskStatus.CANCELLED
            await self._save_task(task)
            return True
        return False
    
    def get_task(self, task_id: str) -> Optional[AITask]:
        """获取任务信息"""
        return self.tasks.get(task_id)
    
    def get_all_tasks(self) -> List[AITask]:
        """获取所有任务"""
        return list(self.tasks.values())
    
    async def _save_task(self, task: AITask):
        """保存任务到数据库"""
        # 实现数据库保存逻辑
        pass
    
    async def _get_question(self, question_id: str) -> Optional[dict]:
        """从数据库获取题目"""
        # 实现数据库查询逻辑
        pass
    
    async def _update_question_answer(self, question_id: str, answer: str):
        """更新题目答案"""
        # 实现数据库更新逻辑
        pass
    
    async def _update_question_explanation(self, question_id: str, explanation: str):
        """更新题目解析"""
        # 实现数据库更新逻辑
        pass
    
    async def _update_question_complete(self, question_id: str, result: dict):
        """更新题目答案和解析"""
        # 实现数据库更新逻辑
        pass
```

---

## 8. 文档解析模块

### 8.1 解析器架构

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          文档解析模块架构                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │                      Document Parser                                │ │
│  │  ┌──────────────────────────────────────────────────────────────┐  │ │
│  │  │                    Parser Factory                             │  │ │
│  │  │                                                               │  │ │
│  │  │   根据文件扩展名选择对应的解析器                               │  │ │
│  │  └──────────────────────────────────────────────────────────────┘  │ │
│  │                              │                                      │ │
│  │         ┌────────────────────┼────────────────────┐                │ │
│  │         ▼                    ▼                    ▼                │ │
│  │  ┌────────────┐      ┌────────────┐      ┌────────────┐           │ │
│  │  │ WordParser │      │ExcelParser │      │ TextParser │           │ │
│  │  │   .docx    │      │.xlsx/.csv  │      │ .txt/.md   │           │ │
│  │  └────────────┘      └────────────┘      └────────────┘           │ │
│  │         │                    │                    │                │ │
│  │         └────────────────────┼────────────────────┘                │ │
│  │                              ▼                                      │ │
│  │  ┌──────────────────────────────────────────────────────────────┐  │ │
│  │  │                  Question Extractor                           │  │ │
│  │  │                                                               │  │ │
│  │  │   • 识别题目类型（单选/多选/判断/简述）                        │  │ │
│  │  │   • 提取题干内容                                              │  │ │
│  │  │   • 提取选项（如有）                                          │  │ │
│  │  │   • 提取答案（如有）                                          │  │ │
│  │  │   • 提取解析（如有）                                          │  │ │
│  │  └──────────────────────────────────────────────────────────────┘  │ │
│  │                              │                                      │ │
│  │                              ▼                                      │ │
│  │  ┌──────────────────────────────────────────────────────────────┐  │ │
│  │  │                  Question Normalizer                          │  │ │
│  │  │                                                               │  │ │
│  │  │   • 标准化题目格式                                            │  │ │
│  │  │   • 验证数据完整性                                            │  │ │
│  │  │   • 生成解析状态                                              │  │ │
│  │  └──────────────────────────────────────────────────────────────┘  │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 8.2 支持的文档格式

| 格式 | 扩展名 | 解析方式 | 说明 |
|------|--------|----------|------|
| Word文档 | .docx | python-docx | 按段落解析，识别题目结构 |
| Excel表格 | .xlsx | openpyxl | 按列映射字段 |
| CSV文件 | .csv | csv模块 | 按列映射字段 |
| 文本文件 | .txt | 正则表达式 | 按行解析，识别题目模式 |
| Markdown | .md | 正则表达式 | 同文本文件 |
| JSON | .json | json模块 | 直接解析结构化数据 |

### 8.3 题目格式规范

#### 8.3.1 Word/TXT格式示例

```
单选题：
1、中华人民共和国成立是哪一年？（ ）
A、1945
B、1948
C、1949
D、1950
答案：C
解析：1949年10月1日，毛泽东在北京天安门城楼上宣告中华人民共和国成立。

2、下列哪个不是HTTP请求方法？（ ）
A、GET
B、POST
C、PUSH
D、DELETE
答案：C

多选题：
1、以下哪些是中国四大发明？（ ）
A、造纸术
B、蒸汽机
C、印刷术
D、指南针
答案：ACD
解析：中国四大发明是造纸术、印刷术、火药和指南针。

判断题：
1、中华人民共和国成立于1949年。（ ）
答案：正确
解析：1949年10月1日，中华人民共和国正式成立。

2、地球是太阳系中最大的行星。（ ）
答案：错误

简述题：
1、请简要描述TCP三次握手的过程。
答案：TCP三次握手过程如下：第一次握手，客户端发送SYN包...
解析：三次握手是TCP建立连接的标准流程...
```

#### 8.3.2 Excel格式示例

| 题型 | 题干 | 选项A | 选项B | 选项C | 选项D | 答案 | 解析 | 难度 |
|------|------|-------|-------|-------|-------|------|------|------|
| single | 中华人民共和国成立是哪一年？ | 1945 | 1948 | 1949 | 1950 | C | 1949年10月1日... | easy |
| multiple | 以下哪些是四大发明？ | 造纸术 | 蒸汽机 | 印刷术 | 指南针 | ACD | | medium |
| judge | 地球是最大的行星 | | | | | 错误 | | easy |
| essay | 简述TCP三次握手 | | | | | 第一次... | | hard |

#### 8.3.3 JSON格式示例

```json
{
    "questions": [
        {
            "type": "single",
            "content": "中华人民共和国成立是哪一年？",
            "options": {
                "A": "1945",
                "B": "1948",
                "C": "1949",
                "D": "1950"
            },
            "answer": "C",
            "explanation": "1949年10月1日...",
            "difficulty": "easy",
            "tags": ["历史", "近代史"]
        }
    ]
}
```

### 8.4 解析器实现

```python
# services/document_parser.py

import re
import json
import csv
from abc import ABC, abstractmethod
from typing import List, Optional
from dataclasses import dataclass
from enum import Enum
from docx import Document
from openpyxl import load_workbook

class QuestionType(Enum):
    SINGLE = "single"
    MULTIPLE = "multiple"
    JUDGE = "judge"
    ESSAY = "essay"
    UNKNOWN = "unknown"

@dataclass
class ParsedQuestion:
    """解析后的题目结构"""
    index: int
    type: QuestionType
    content: str
    options: Optional[dict] = None
    answer: Optional[str] = None
    explanation: Optional[str] = None
    parse_status: str = "success"
    parse_message: Optional[str] = None
    
    @property
    def has_answer(self) -> bool:
        return self.answer is not None and self.answer.strip() != ""
    
    @property
    def has_explanation(self) -> bool:
        return self.explanation is not None and self.explanation.strip() != ""
    
    def to_dict(self) -> dict:
        return {
            "index": self.index,
            "type": self.type.value,
            "content": self.content,
            "options": self.options,
            "answer": self.answer,
            "explanation": self.explanation,
            "hasAnswer": self.has_answer,
            "hasExplanation": self.has_explanation,
            "parseStatus": self.parse_status,
            "parseMessage": self.parse_message
        }

class BaseParser(ABC):
    """解析器基类"""
    
    @abstractmethod
    def parse(self, file_path: str) -> List[ParsedQuestion]:
        pass
    
    def detect_question_type(self, content: str, options: dict = None) -> QuestionType:
        """检测题目类型"""
        content_lower = content.lower()
        
        # 根据关键词判断
        if any(kw in content for kw in ["单选", "单项选择"]):
            return QuestionType.SINGLE
        if any(kw in content for kw in ["多选", "多项选择"]):
            return QuestionType.MULTIPLE
        if any(kw in content for kw in ["判断", "正误"]):
            return QuestionType.JUDGE
        if any(kw in content for kw in ["简述", "简答", "论述", "分析"]):
            return QuestionType.ESSAY
        
        # 根据选项判断
        if options:
            if len(options) >= 2:
                return QuestionType.SINGLE  # 默认有选项的是单选
        
        # 根据括号判断
        if re.search(r'[（(]\s*[）)]', content):
            if options:
                return QuestionType.SINGLE
            else:
                return QuestionType.JUDGE
        
        return QuestionType.UNKNOWN

class WordParser(BaseParser):
    """Word文档解析器"""
    
    # 题目类型标记正则
    TYPE_PATTERNS = {
        QuestionType.SINGLE: r'单选题|单项选择题',
        QuestionType.MULTIPLE: r'多选题|多项选择题',
        QuestionType.JUDGE: r'判断题',
        QuestionType.ESSAY: r'简述题|简答题|论述题'
    }
    
    # 题号正则
    QUESTION_NUM_PATTERN = r'^[\d一二三四五六七八九十]+[、.．。)\s]+'
    
    # 选项正则
    OPTION_PATTERN = r'^([A-Fa-f])[、.．。)\s]+(.+)$'
    
    # 答案正则
    ANSWER_PATTERN = r'^答案[：:]\s*(.+)$'
    
    # 解析正则
    EXPLANATION_PATTERN = r'^解析[：:]\s*(.+)$'
    
    def parse(self, file_path: str) -> List[ParsedQuestion]:
        doc = Document(file_path)
        questions = []
        
        current_type = QuestionType.UNKNOWN
        current_question = None
        current_options = {}
        collecting_explanation = False
        question_index = 0
        
        for para in doc.paragraphs:
            text = para.text.strip()
            if not text:
                continue
            
            # 检测题目类型标记
            for q_type, pattern in self.TYPE_PATTERNS.items():
                if re.search(pattern, text):
                    current_type = q_type
                    continue
            
            # 检测答案行
            answer_match = re.match(self.ANSWER_PATTERN, text)
            if answer_match:
                if current_question:
                    current_question.answer = answer_match.group(1).strip()
                collecting_explanation = False
                continue
            
            # 检测解析行
            explanation_match = re.match(self.EXPLANATION_PATTERN, text)
            if explanation_match:
                if current_question:
                    current_question.explanation = explanation_match.group(1).strip()
                collecting_explanation = True
                continue
            
            # 继续收集解析内容
            if collecting_explanation and current_question:
                current_question.explanation += "\n" + text
                continue
            
            # 检测选项行
            option_match = re.match(self.OPTION_PATTERN, text)
            if option_match:
                option_key = option_match.group(1).upper()
                option_value = option_match.group(2).strip()
                current_options[option_key] = option_value
                continue
            
            # 检测新题目
            if re.match(self.QUESTION_NUM_PATTERN, text):
                # 保存上一题
                if current_question:
                    if current_options:
                        current_question.options = current_options.copy()
                    if current_question.type == QuestionType.UNKNOWN:
                        current_question.type = self.detect_question_type(
                            current_question.content, 
                            current_question.options
                        )
                    questions.append(current_question)
                
                # 开始新题目
                question_index += 1
                content = re.sub(self.QUESTION_NUM_PATTERN, '', text).strip()
                current_question = ParsedQuestion(
                    index=question_index,
                    type=current_type,
                    content=content
                )
                current_options = {}
                collecting_explanation = False
                continue
            
            # 普通文本，追加到当前题目
            if current_question:
                current_question.content += "\n" + text
        
        # 保存最后一题
        if current_question:
            if current_options:
                current_question.options = current_options.copy()
            if current_question.type == QuestionType.UNKNOWN:
                current_question.type = self.detect_question_type(
                    current_question.content,
                    current_question.options
                )
            questions.append(current_question)
        
        return questions

class ExcelParser(BaseParser):
    """Excel/CSV解析器"""
    
    # 列名映射
    COLUMN_MAPPING = {
        "type": ["题型", "类型", "type"],
        "content": ["题干", "题目", "内容", "content", "question"],
        "option_a": ["选项A", "A", "option_a", "optionA"],
        "option_b": ["选项B", "B", "option_b", "optionB"],
        "option_c": ["选项C", "C", "option_c", "optionC"],
        "option_d": ["选项D", "D", "option_d", "optionD"],
        "option_e": ["选项E", "E", "option_e", "optionE"],
        "option_f": ["选项F", "F", "option_f", "optionF"],
        "answer": ["答案", "正确答案", "answer"],
        "explanation": ["解析", "解答", "explanation"],
        "difficulty": ["难度", "difficulty"],
        "tags": ["标签", "知识点", "tags"]
    }
    
    TYPE_MAPPING = {
        "单选": QuestionType.SINGLE,
        "单选题": QuestionType.SINGLE,
        "single": QuestionType.SINGLE,
        "多选": QuestionType.MULTIPLE,
        "多选题": QuestionType.MULTIPLE,
        "multiple": QuestionType.MULTIPLE,
        "判断": QuestionType.JUDGE,
        "判断题": QuestionType.JUDGE,
        "judge": QuestionType.JUDGE,
        "简述": QuestionType.ESSAY,
        "简答": QuestionType.ESSAY,
        "简述题": QuestionType.ESSAY,
        "essay": QuestionType.ESSAY
    }
    
    def parse(self, file_path: str) -> List[ParsedQuestion]:
        if file_path.endswith('.csv'):
            return self._parse_csv(file_path)
        else:
            return self._parse_xlsx(file_path)
    
    def _parse_xlsx(self, file_path: str) -> List[ParsedQuestion]:
        wb = load_workbook(file_path)
        ws = wb.active
        
        # 读取表头
        headers = [cell.value for cell in ws[1]]
        column_map = self._map_columns(headers)
        
        questions = []
        for idx, row in enumerate(ws.iter_rows(min_row=2, values_only=True), 1):
            try:
                question = self._parse_row(row, column_map, idx)
                if question:
                    questions.append(question)
            except Exception as e:
                questions.append(ParsedQuestion(
                    index=idx,
                    type=QuestionType.UNKNOWN,
                    content=str(row),
                    parse_status="error",
                    parse_message=str(e)
                ))
        
        return questions
    
    def _parse_csv(self, file_path: str) -> List[ParsedQuestion]:
        questions = []
        with open(file_path, 'r', encoding='utf-8-sig') as f:
            reader = csv.reader(f)
            headers = next(reader)
            column_map = self._map_columns(headers)
            
            for idx, row in enumerate(reader, 1):
                try:
                    question = self._parse_row(row, column_map, idx)
                    if question:
                        questions.append(question)
                except Exception as e:
                    questions.append(ParsedQuestion(
                        index=idx,
                        type=QuestionType.UNKNOWN,
                        content=str(row),
                        parse_status="error",
                        parse_message=str(e)
                    ))
        
        return questions
    
    def _map_columns(self, headers: List[str]) -> dict:
        """映射列名到索引"""
        column_map = {}
        for idx, header in enumerate(headers):
            if not header:
                continue
            header_lower = header.lower().strip()
            for field, aliases in self.COLUMN_MAPPING.items():
                if header_lower in [a.lower() for a in aliases]:
                    column_map[field] = idx
                    break
        return column_map
    
    def _parse_row(self, row: tuple, column_map: dict, index: int) -> Optional[ParsedQuestion]:
        """解析单行数据"""
        def get_value(field: str) -> Optional[str]:
            if field in column_map:
                idx = column_map[field]
                if idx < len(row) and row[idx]:
                    return str(row[idx]).strip()
            return None
        
        content = get_value("content")
        if not content:
            return None
        
        # 解析题型
        type_str = get_value("type")
        q_type = self.TYPE_MAPPING.get(type_str, QuestionType.UNKNOWN) if type_str else QuestionType.UNKNOWN
        
        # 解析选项
        options = {}
        for opt in ['a', 'b', 'c', 'd', 'e', 'f']:
            value = get_value(f"option_{opt}")
            if value:
                options[opt.upper()] = value
        
        # 如果未识别题型，尝试自动识别
        if q_type == QuestionType.UNKNOWN:
            q_type = self.detect_question_type(content, options if options else None)
        
        return ParsedQuestion(
            index=index,
            type=q_type,
            content=content,
            options=options if options else None,
            answer=get_value("answer"),
            explanation=get_value("explanation")
        )

class TextParser(BaseParser):
    """文本文件解析器（TXT/Markdown）"""
    
    def parse(self, file_path: str) -> List[ParsedQuestion]:
        with open(file_path, 'r', encoding='utf-8') as f:
            content = f.read()
        
        # 使用WordParser的解析逻辑，但输入是纯文本
        questions = []
        lines = content.split('\n')
        
        # 复用Word解析器的模式
        word_parser = WordParser()
        
        current_type = QuestionType.UNKNOWN
        current_question = None
        current_options = {}
        question_index = 0
        
        for line in lines:
            text = line.strip()
            if not text:
                continue
            
            # 检测题目类型标记
            for q_type, pattern in word_parser.TYPE_PATTERNS.items():
                if re.search(pattern, text):
                    current_type = q_type
                    continue
            
            # 检测答案行
            answer_match = re.match(word_parser.ANSWER_PATTERN, text)
            if answer_match:
                if current_question:
                    current_question.answer = answer_match.group(1).strip()
                continue
            
            # 检测解析行
            explanation_match = re.match(word_parser.EXPLANATION_PATTERN, text)
            if explanation_match:
                if current_question:
                    current_question.explanation = explanation_match.group(1).strip()
                continue
            
            # 检测选项行
            option_match = re.match(word_parser.OPTION_PATTERN, text)
            if option_match:
                option_key = option_match.group(1).upper()
                option_value = option_match.group(2).strip()
                current_options[option_key] = option_value
                continue
            
            # 检测新题目
            if re.match(word_parser.QUESTION_NUM_PATTERN, text):
                # 保存上一题
                if current_question:
                    if current_options:
                        current_question.options = current_options.copy()
                    if current_question.type == QuestionType.UNKNOWN:
                        current_question.type = self.detect_question_type(
                            current_question.content,
                            current_question.options
                        )
                    questions.append(current_question)
                
                # 开始新题目
                question_index += 1
                content = re.sub(word_parser.QUESTION_NUM_PATTERN, '', text).strip()
                current_question = ParsedQuestion(
                    index=question_index,
                    type=current_type,
                    content=content
                )
                current_options = {}
        
        # 保存最后一题
        if current_question:
            if current_options:
                current_question.options = current_options.copy()
            if current_question.type == QuestionType.UNKNOWN:
                current_question.type = self.detect_question_type(
                    current_question.content,
                    current_question.options
                )
            questions.append(current_question)
        
        return questions

class JsonParser(BaseParser):
    """JSON文件解析器"""
    
    TYPE_MAPPING = {
        "single": QuestionType.SINGLE,
        "multiple": QuestionType.MULTIPLE,
        "judge": QuestionType.JUDGE,
        "essay": QuestionType.ESSAY
    }
    
    def parse(self, file_path: str) -> List[ParsedQuestion]:
        with open(file_path, 'r', encoding='utf-8') as f:
            data = json.load(f)
        
        questions_data = data if isinstance(data, list) else data.get("questions", [])
        
        questions = []
        for idx, q in enumerate(questions_data, 1):
            q_type = self.TYPE_MAPPING.get(q.get("type"), QuestionType.UNKNOWN)
            
            questions.append(ParsedQuestion(
                index=idx,
                type=q_type,
                content=q.get("content", ""),
                options=q.get("options"),
                answer=q.get("answer"),
                explanation=q.get("explanation")
            ))
        
        return questions

class DocumentParserFactory:
    """解析器工厂"""
    
    PARSERS = {
        '.docx': WordParser,
        '.xlsx': ExcelParser,
        '.csv': ExcelParser,
        '.txt': TextParser,
        '.md': TextParser,
        '.json': JsonParser
    }
    
    @classmethod
    def get_parser(cls, file_path: str) -> BaseParser:
        ext = '.' + file_path.rsplit('.', 1)[-1].lower()
        parser_class = cls.PARSERS.get(ext)
        if not parser_class:
            raise ValueError(f"不支持的文件格式: {ext}")
        return parser_class()
    
    @classmethod
    def parse(cls, file_path: str) -> List[ParsedQuestion]:
        parser = cls.get_parser(file_path)
        return parser.parse(file_path)
    
    @classmethod
    def get_statistics(cls, questions: List[ParsedQuestion]) -> dict:
        """获取解析统计"""
        stats = {
            "total": len(questions),
            "success": 0,
            "warning": 0,
            "error": 0,
            "complete": 0,
            "hasAnswer": 0,
            "onlyContent": 0,
            "byType": {
                "single": 0,
                "multiple": 0,
                "judge": 0,
                "essay": 0,
                "unknown": 0
            }
        }
        
        for q in questions:
            # 统计解析状态
            if q.parse_status == "success":
                stats["success"] += 1
            elif q.parse_status == "warning":
                stats["warning"] += 1
            else:
                stats["error"] += 1
            
            # 统计完整度
            if q.has_answer and q.has_explanation:
                stats["complete"] += 1
            elif q.has_answer:
                stats["hasAnswer"] += 1
            else:
                stats["onlyContent"] += 1
            
            # 统计题型
            stats["byType"][q.type.value] += 1
        
        return stats
```



## 9. 部署方案

### 9.1 部署架构

```
┌─────────────────────────────────────────────────────────────────────────┐
│                            服务器部署架构                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│                              互联网用户                                  │
│                                  │                                       │
│                                  ▼                                       │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                        宿主机 (Host)                               │  │
│  │                                                                    │  │
│  │   ┌────────────────────────────────────────────────────────────┐  │  │
│  │   │              可选：Nginx 反向代理                           │  │  │
│  │   │              (域名 + SSL/HTTPS)                             │  │  │
│  │   │                                                             │  │  │
│  │   │   server {                                                  │  │  │
│  │   │       listen 443 ssl;                                       │  │  │
│  │   │       server_name quiz.example.com;                         │  │  │
│  │   │       location / {                                          │  │  │
│  │   │           proxy_pass http://127.0.0.1:5173;                 │  │  │
│  │   │       }                                                     │  │  │
│  │   │   }                                                         │  │  │
│  │   └────────────────────────────────────────────────────────────┘  │  │
│  │                               │                                    │  │
│  │                               ▼                                    │  │
│  │   ┌────────────────────────────────────────────────────────────┐  │  │
│  │   │                  Docker Compose                             │  │  │
│  │   │   ┌─────────────────────────────────────────────────────┐  │  │  │
│  │   │   │                                                      │  │  │  │
│  │   │   │   ┌──────────────┐      ┌──────────────┐            │  │  │  │
│  │   │   │   │   Frontend   │      │   Backend    │            │  │  │  │
│  │   │   │   │              │      │              │            │  │  │  │
│  │   │   │   │  Port: 5173  │─────▶│  Port: 8000  │            │  │  │  │
│  │   │   │   │              │ /api │              │            │  │  │  │
│  │   │   │   │   Vue 3 +    │      │  FastAPI +   │            │  │  │  │
│  │   │   │   │   Vite       │      │  SQLite      │            │  │  │  │
│  │   │   │   └──────────────┘      └──────┬───────┘            │  │  │  │
│  │   │   │                                │                     │  │  │  │
│  │   │   │                         ┌──────▼───────┐            │  │  │  │
│  │   │   │                         │    Volumes   │            │  │  │  │
│  │   │   │                         │  ./data      │            │  │  │  │
│  │   │   │                         │  ./backup    │            │  │  │  │
│  │   │   │                         └──────────────┘            │  │  │  │
│  │   │   │                                                      │  │  │  │
│  │   │   └─────────────────────────────────────────────────────┘  │  │  │
│  │   └────────────────────────────────────────────────────────────┘  │  │
│  │                                                                    │  │
│  │   访问方式:                                                        │  │
│  │   • 直接访问: http://服务器IP:5173                                 │  │
│  │   • 域名访问: https://quiz.example.com (需配置宿主机Nginx)        │  │
│  │                                                                    │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 9.2 项目文件结构

```
quiz-learning-system/
│
├── docker-compose.yml          # Docker编排配置
├── docker-compose.prod.yml     # 生产环境配置（可选）
├── .env.example                # 环境变量示例
├── .env                        # 实际环境变量（不提交git）
├── Makefile                    # 便捷命令
├── README.md                   # 项目说明
│
├── backend/                    # 后端代码
│   ├── Dockerfile
│   ├── requirements.txt
│   └── ...
│
├── frontend/                   # 前端代码
│   ├── Dockerfile
│   ├── package.json
│   └── ...
│
├── data/                       # 数据持久化（自动创建）
│   └── quiz.db
│
└── backup/                     # 备份文件目录
    └── ...
```

### 9.3 Docker配置文件

#### 9.3.1 docker-compose.yml

```yaml
version: '3.8'

services:
  # 前端服务
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: quiz-frontend
    restart: unless-stopped
    ports:
      - "${FRONTEND_PORT:-5173}:80"
    environment:
      - VITE_API_BASE_URL=/api
    depends_on:
      - backend
    networks:
      - quiz-network

  # 后端服务
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: quiz-backend
    restart: unless-stopped
    ports:
      - "${BACKEND_PORT:-8000}:8000"
    environment:
      - DATABASE_PATH=/app/data/quiz.db
      - OPENAI_API_URL=${OPENAI_API_URL:-https://api.openai.com/v1}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - OPENAI_MODEL=${OPENAI_MODEL:-gpt-4o-mini}
      - ADMIN_PASSWORD=${ADMIN_PASSWORD:-}
      - JWT_SECRET=${JWT_SECRET:-your-secret-key-change-in-production}
      - JWT_EXPIRE_HOURS=${JWT_EXPIRE_HOURS:-24}
    volumes:
      - ./data:/app/data
      - ./backup:/app/backup
    networks:
      - quiz-network

networks:
  quiz-network:
    driver: bridge
```

#### 9.3.2 后端 Dockerfile (backend/Dockerfile)

```dockerfile
# 构建阶段
FROM python:3.11-slim as builder

WORKDIR /app

# 安装构建依赖
RUN apt-get update && apt-get install -y --no-install-recommends \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

# 复制依赖文件
COPY requirements.txt .

# 安装Python依赖
RUN pip install --no-cache-dir --user -r requirements.txt

# 运行阶段
FROM python:3.11-slim

WORKDIR /app

# 安装运行时依赖
RUN apt-get update && apt-get install -y --no-install-recommends \
    libmagic1 \
    && rm -rf /var/lib/apt/lists/*

# 从构建阶段复制依赖
COPY --from=builder /root/.local /root/.local

# 确保脚本在PATH中
ENV PATH=/root/.local/bin:$PATH

# 复制应用代码
COPY . .

# 创建数据目录
RUN mkdir -p /app/data /app/backup

# 暴露端口
EXPOSE 8000

# 启动命令
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
```

#### 9.3.3 后端依赖 (backend/requirements.txt)

```
# Web框架
fastapi==0.109.2
uvicorn[standard]==0.27.1
python-multipart==0.0.9

# 数据库
sqlalchemy==2.0.25
aiosqlite==0.19.0

# 数据验证
pydantic==2.6.1
pydantic-settings==2.1.0

# 认证
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4

# AI客户端
openai==1.12.0

# 文档解析
python-docx==1.1.0
openpyxl==3.1.2

# 工具
python-magic==0.4.27
aiofiles==23.2.1
```

#### 9.3.4 前端 Dockerfile (frontend/Dockerfile)

```dockerfile
# 构建阶段
FROM node:20-alpine as builder

WORKDIR /app

# 复制package文件
COPY package.json pnpm-lock.yaml ./

# 安装pnpm并安装依赖
RUN npm install -g pnpm && pnpm install --frozen-lockfile

# 复制源代码
COPY . .

# 构建应用
RUN pnpm build

# 运行阶段 - 使用轻量级nginx
FROM nginx:alpine

# 复制构建产物
COPY --from=builder /app/dist /usr/share/nginx/html

# 复制nginx配置
COPY nginx.conf /etc/nginx/conf.d/default.conf

# 暴露端口
EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
```

#### 9.3.5 前端Nginx配置 (frontend/nginx.conf)

```nginx
server {
    listen 80;
    server_name localhost;
    
    root /usr/share/nginx/html;
    index index.html;
    
    # Gzip压缩
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_proxied any;
    gzip_types text/plain text/css text/xml text/javascript application/javascript application/json application/xml;
    
    # 静态资源缓存
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # API代理
    location /api/ {
        proxy_pass http://backend:8000/api/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        proxy_read_timeout 300s;
        proxy_connect_timeout 75s;
        
        # SSE支持（用于流式输出）
        proxy_buffering off;
        proxy_cache off;
    }
    
    # SPA路由支持
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # 健康检查
    location /health {
        access_log off;
        return 200 "OK";
        add_header Content-Type text/plain;
    }
}
```

#### 9.3.6 环境变量配置 (.env.example)

```bash
# ===== 端口配置 =====
FRONTEND_PORT=5173
BACKEND_PORT=8000

# ===== AI配置 =====
# OpenAI兼容API地址
OPENAI_API_URL=https://api.openai.com/v1
# API密钥
OPENAI_API_KEY=sk-your-api-key-here
# 模型名称
OPENAI_MODEL=gpt-4o-mini

# ===== 安全配置 =====
# 管理员初始密码（首次启动时设置，之后可在界面修改）
ADMIN_PASSWORD=
# JWT密钥（请修改为随机字符串）
JWT_SECRET=your-super-secret-jwt-key-please-change-this
# JWT过期时间（小时）
JWT_EXPIRE_HOURS=24
```

#### 9.3.7 Makefile

```makefile
.PHONY: help build up down restart logs shell backup restore clean

# 默认目标
help:
	@echo "智能答题学习系统 - 管理命令"
	@echo ""
	@echo "使用方法: make <命令>"
	@echo ""
	@echo "命令列表:"
	@echo "  build     构建Docker镜像"
	@echo "  up        启动所有服务"
	@echo "  down      停止所有服务"
	@echo "  restart   重启所有服务"
	@echo "  logs      查看日志"
	@echo "  shell     进入后端容器Shell"
	@echo "  backup    备份数据"
	@echo "  restore   恢复数据 (用法: make restore FILE=备份文件名)"
	@echo "  clean     清理未使用的Docker资源"
	@echo ""

# 构建镜像
build:
	docker-compose build

# 启动服务
up:
	docker-compose up -d

# 停止服务
down:
	docker-compose down

# 重启服务
restart:
	docker-compose restart

# 查看日志
logs:
	docker-compose logs -f

# 查看后端日志
logs-backend:
	docker-compose logs -f backend

# 查看前端日志
logs-frontend:
	docker-compose logs -f frontend

# 进入后端容器
shell:
	docker-compose exec backend /bin/sh

# 备份数据
backup:
	@echo "正在备份数据..."
	@mkdir -p backup
	@BACKUP_FILE="backup/quiz_backup_$$(date +%Y%m%d_%H%M%S).tar.gz"; \
	tar -czvf $$BACKUP_FILE data/; \
	echo "备份完成: $$BACKUP_FILE"

# 恢复数据
restore:
	@if [ -z "$(FILE)" ]; then \
		echo "请指定备份文件: make restore FILE=backup/xxx.tar.gz"; \
		exit 1; \
	fi
	@echo "正在恢复数据..."
	@docker-compose down
	@tar -xzvf $(FILE)
	@docker-compose up -d
	@echo "恢复完成"

# 清理Docker资源
clean:
	docker system prune -f

# 完全重置（危险！会删除所有数据）
reset:
	@echo "警告: 这将删除所有数据！"
	@read -p "确定要继续吗? (输入 yes 确认): " confirm; \
	if [ "$$confirm" = "yes" ]; then \
		docker-compose down -v; \
		rm -rf data/*; \
		echo "已重置"; \
	else \
		echo "已取消"; \
	fi

# 更新代码并重新部署
update:
	git pull
	docker-compose build
	docker-compose up -d
	@echo "更新完成"
```

### 9.4 部署步骤

#### 9.4.1 首次部署

```bash
# 1. 克隆项目
git clone https://github.com/your-repo/quiz-learning-system.git
cd quiz-learning-system

# 2. 复制环境变量配置
cp .env.example .env

# 3. 编辑环境变量
vim .env
# 修改以下配置：
# - OPENAI_API_KEY: 你的AI API密钥
# - OPENAI_API_URL: AI API地址（如使用其他服务）
# - JWT_SECRET: 修改为随机字符串

# 4. 构建并启动
make build
make up

# 5. 查看日志确认启动成功
make logs

# 6. 访问系统
# 浏览器打开: http://服务器IP:5173
# 首次访问需设置管理员密码
```

#### 9.4.2 宿主机Nginx反代配置（可选）

如需通过域名访问，在宿主机Nginx添加以下配置：

```nginx
# /etc/nginx/conf.d/quiz.conf

server {
    listen 80;
    server_name quiz.example.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name quiz.example.com;
    
    # SSL证书
    ssl_certificate /etc/nginx/ssl/quiz.example.com.crt;
    ssl_certificate_key /etc/nginx/ssl/quiz.example.com.key;
    
    # SSL配置
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256;
    ssl_prefer_server_ciphers on;
    
    # 代理到Docker容器
    location / {
        proxy_pass http://127.0.0.1:5173;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        
        # SSE支持
        proxy_buffering off;
        proxy_read_timeout 300s;
    }
}
```

```bash
# 重载Nginx配置
sudo nginx -t
sudo systemctl reload nginx
```

### 9.5 运维命令

```bash
# 查看服务状态
docker-compose ps

# 查看实时日志
make logs

# 重启服务
make restart

# 备份数据
make backup

# 恢复数据
make restore FILE=backup/quiz_backup_20240120_160000.tar.gz

# 更新系统
git pull
make build
make restart
```

---

## 10. 开发计划

### 10.1 开发阶段划分

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          开发阶段规划                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  第一阶段：基础框架搭建（3天）                                           │
│  ├── Day 1: 项目初始化                                                  │
│  │   ├── 后端FastAPI项目结构                                            │
│  │   ├── 前端Vue3项目结构                                               │
│  │   └── Docker配置                                                     │
│  ├── Day 2: 数据库与认证                                                │
│  │   ├── SQLite数据库模型                                               │
│  │   ├── JWT认证实现                                                    │
│  │   └── 基础API框架                                                    │
│  └── Day 3: 前端基础                                                    │
│      ├── 路由配置                                                       │
│      ├── 布局组件                                                       │
│      └── API请求封装                                                    │
│                                                                          │
│  第二阶段：题库管理（4天）                                               │
│  ├── Day 4: 题目CRUD                                                    │
│  │   ├── 题目API接口                                                    │
│  │   └── 题目列表页面                                                   │
│  ├── Day 5: 分类管理                                                    │
│  │   ├── 分类API接口                                                    │
│  │   └── 分类管理页面                                                   │
│  ├── Day 6: 文档导入                                                    │
│  │   ├── 文档解析模块                                                   │
│  │   └── 导入预览页面                                                   │
│  └── Day 7: 导入导出完善                                                │
│      ├── 多格式支持                                                     │
│      └── 导出功能                                                       │
│                                                                          │
│  第三阶段：AI功能（3天）                                                 │
│  ├── Day 8: AI基础服务                                                  │
│  │   ├── AI服务封装                                                     │
│  │   ├── Prompt设计                                                     │
│  │   └── 单题补全API                                                    │
│  ├── Day 9: 批量任务                                                    │
│  │   ├── 任务管理器                                                     │
│  │   ├── 批量补全API                                                    │
│  │   └── 任务进度页面                                                   │
│  └── Day 10: AI功能完善                                                 │
│      ├── 流式输出                                                       │
│      ├── 确认机制                                                       │
│      └── 知识点追问                                                     │
│                                                                          │
│  第四阶段：组卷答题（4天）                                               │
│  ├── Day 11: 组卷功能                                                   │
│  │   ├── 组卷算法                                                       │
│  │   ├── 组卷API                                                        │
│  │   └── 组卷页面                                                       │
│  ├── Day 12: 答题页面                                                   │
│  │   ├── 答题组件                                                       │
│  │   ├── 计时器                                                         │
│  │   └── 答题卡                                                         │
│  ├── Day 13: 评分与结果                                                 │
│  │   ├── 自动评分                                                       │
│  │   ├── 结果页面                                                       │
│  │   └── 答案解析展示                                                   │
│  └── Day 14: AI分析报告                                                 │
│      ├── 报告生成API                                                    │
│      ├── 报告展示组件                                                   │
│      └── 报告导出                                                       │
│                                                                          │
│  第五阶段：学习追踪（2天）                                               │
│  ├── Day 15: 错题本                                                     │
│  │   ├── 错题收集逻辑                                                   │
│  │   ├── 错题API                                                        │
│  │   └── 错题本页面                                                     │
│  └── Day 16: 学习统计                                                   │
│      ├── 统计数据计算                                                   │
│      ├── 统计API                                                        │
│      └── 统计图表页面                                                   │
│                                                                          │
│  第六阶段：系统完善（2天）                                               │
│  ├── Day 17: 系统设置                                                   │
│  │   ├── 设置页面                                                       │
│  │   ├── 数据备份恢复                                                   │
│  │   └── AI配置测试                                                     │
│  └── Day 18: 测试与优化                                                 │
│      ├── 功能测试                                                       │
│      ├── 性能优化                                                       │
│      └── Bug修复                                                        │
│                                                                          │
│  总计：约18天                                                            │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 10.2 详细任务分解

#### 第一阶段：基础框架搭建（3天）

| 任务 | 子任务 | 预计时间 | 优先级 |
|------|--------|----------|--------|
| 后端初始化 | FastAPI项目结构 | 2h | P0 |
| | SQLAlchemy配置 | 1h | P0 |
| | 数据库模型定义 | 2h | P0 |
| | 数据库初始化脚本 | 1h | P0 |
| 认证模块 | JWT工具函数 | 1h | P0 |
| | 登录/登出API | 2h | P0 |
| | 认证中间件 | 1h | P0 |
| 前端初始化 | Vue3+Vite项目 | 1h | P0 |
| | Tailwind+NaiveUI配置 | 1h | P0 |
| | 路由配置 | 1h | P0 |
| | Pinia状态管理 | 1h | P0 |
| | Axios封装 | 1h | P0 |
| 布局组件 | MainLayout | 2h | P0 |
| | Header/Sidebar | 2h | P0 |
| | 登录页面 | 2h | P0 |
| Docker配置 | docker-compose.yml | 1h | P0 |
| | Dockerfile(前后端) | 2h | P0 |

#### 第二阶段：题库管理（4天）

| 任务 | 子任务 | 预计时间 | 优先级 |
|------|--------|----------|--------|
| 题目API | 题目CRUD接口 | 3h | P0 |
| | 分页/搜索/筛选 | 2h | P0 |
| | 题库统计接口 | 1h | P0 |
| 题目页面 | 题目列表页 | 4h | P0 |
| | 题目详情页 | 2h | P0 |
| | 题目表单组件 | 3h | P0 |
| | 添加/编辑页 | 2h | P0 |
| 分类功能 | 分类CRUD接口 | 2h | P0 |
| | 分类树组件 | 3h | P0 |
| | 分类管理页 | 2h | P0 |
| 文档解析 | WordParser | 4h | P0 |
| | ExcelParser | 2h | P0 |
| | TextParser | 2h | P0 |
| | JsonParser | 1h | P1 |
| | 解析工厂 | 1h | P0 |
| 导入功能 | 导入预览API | 2h | P0 |
| | 导入确认API | 2h | P0 |
| | 导入页面 | 4h | P0 |
| 导出功能 | 导出API | 2h | P1 |
| | 导出格式处理 | 2h | P1 |

#### 第三阶段：AI功能（3天）

| 任务 | 子任务 | 预计时间 | 优先级 |
|------|--------|----------|--------|
| AI服务 | OpenAI客户端封装 | 2h | P0 |
| | Prompt模板 | 2h | P0 |
| | 答案生成接口 | 2h | P0 |
| | 解析生成接口 | 2h | P0 |
| | 完整补全接口 | 1h | P0 |
| 批量任务 | 任务管理器 | 3h | P0 |
| | 批量补全API | 2h | P0 |
| | 任务控制API | 2h | P0 |
| | 任务进度存储 | 1h | P0 |
| 前端AI功能 | AI补全弹窗 | 3h | P0 |
| | 任务进度组件 | 2h | P0 |
| | 确认/编辑机制 | 2h | P0 |
| 流式输出 | SSE接口 | 2h | P1 |
| | 前端流式处理 | 2h | P1 |
| 追问功能 | 追问API | 1h | P1 |
| | 追问弹窗 | 2h | P1 |

#### 第四阶段：组卷答题（4天）

| 任务 | 子任务 | 预计时间 | 优先级 |
|------|--------|----------|--------|
| 组卷功能 | 组卷算法 | 3h | P0 |
| | 组卷API | 2h | P0 |
| | 快速组卷 | 1h | P0 |
| | 组卷配置页 | 4h | P0 |
| 答题功能 | 试卷数据API | 2h | P0 |
| | 保存答案API | 1h | P0 |
| | 答题页面 | 5h | P0 |
| | 答题卡组件 | 2h | P0 |
| | 计时器组件 | 1h | P0 |
| 评分结果 | 提交评分API | 3h | P0 |
| | 结果数据处理 | 2h | P0 |
| | 结果页面 | 4h | P0 |
| | 答案解析展示 | 2h | P0 |
| AI报告 | 报告生成Prompt | 2h | P0 |
| | 报告API | 2h | P0 |
| | 报告弹窗组件 | 3h | P0 |
| 答题历史 | 历史API | 1h | P1 |
| | 历史列表页 | 2h | P1 |

#### 第五阶段：学习追踪（2天）

| 任务 | 子任务 | 预计时间 | 优先级 |
|------|--------|----------|--------|
| 错题本 | 错题收集逻辑 | 2h | P0 |
| | 错题API | 2h | P0 |
| | 错题本页面 | 3h | P0 |
| | 错题重做 | 2h | P0 |
| 学习统计 | 统计数据计算 | 2h | P1 |
| | 统计API | 1h | P1 |
| | 首页仪表盘 | 4h | P1 |
| | 统计图表页 | 3h | P1 |

#### 第六阶段：系统完善（2天）

| 任务 | 子任务 | 预计时间 | 优先级 |
|------|--------|----------|--------|
| 系统设置 | 设置API | 2h | P0 |
| | 设置页面 | 3h | P0 |
| | AI连接测试 | 1h | P0 |
| 数据管理 | 备份API | 2h | P1 |
| | 恢复API | 2h | P1 |
| | 备份恢复UI | 2h | P1 |
| 密码管理 | 修改密码API | 1h | P0 |
| | 修改密码UI | 1h | P0 |
| 测试优化 | 功能测试 | 4h | P0 |
| | Bug修复 | 4h | P0 |
| | 性能优化 | 2h | P1 |
| | 文档完善 | 2h | P1 |

### 10.3 里程碑

| 里程碑 | 完成时间 | 交付物 |
|--------|----------|--------|
| M1: 基础可运行 | Day 3 | 可登录的空系统 |
| M2: 题库管理完成 | Day 7 | 完整题库CRUD+导入导出 |
| M3: AI功能完成 | Day 10 | AI补全+批量任务 |
| M4: 答题功能完成 | Day 14 | 组卷+答题+评分+报告 |
| M5: 系统完整版 | Day 18 | 全功能可用版本 |

---

## 11. 附录

### 11.1 技术参考文档

| 技术 | 文档地址 |
|------|----------|
| Vue 3 | https://vuejs.org/guide/introduction.html |
| Vite | https://vitejs.dev/guide/ |
| Naive UI | https://www.naiveui.com/zh-CN/os-theme/docs/introduction |
| Tailwind CSS | https://tailwindcss.com/docs |
| Pinia | https://pinia.vuejs.org/zh/ |
| FastAPI | https://fastapi.tiangolo.com/zh/ |
| SQLAlchemy | https://docs.sqlalchemy.org/en/20/ |
| OpenAI API | https://platform.openai.com/docs/api-reference |
| python-docx | https://python-docx.readthedocs.io/ |
| Docker Compose | https://docs.docker.com/compose/ |

### 11.2 常见问题

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           常见问题解答                                   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  Q1: 如何更换AI服务提供商？                                              │
│  A: 修改.env文件中的OPENAI_API_URL和OPENAI_API_KEY，系统兼容所有        │
│     OpenAI格式的API。常见兼容服务：                                      │
│     - DeepSeek: https://api.deepseek.com/v1                             │
│     - Claude: 需使用适配层                                               │
│     - 本地Ollama: http://localhost:11434/v1                             │
│                                                                          │
│  Q2: 数据库文件在哪里？如何备份？                                        │
│  A: 数据库文件位于 ./data/quiz.db，直接复制此文件即可备份。              │
│     也可使用 make backup 命令自动打包备份。                              │
│                                                                          │
│  Q3: 忘记管理员密码怎么办？                                              │
│  A: 两种方式：                                                           │
│     1. 删除data/quiz.db，重新初始化                                     │
│     2. 使用SQLite工具清空settings表中的admin_password_hash记录          │
│                                                                          │
│  Q4: 导入的题目格式不正确怎么办？                                        │
│  A: 系统支持多种格式，建议：                                             │
│     1. 使用导入预览功能检查解析结果                                      │
│     2. 参考附录中的格式示例调整文档                                      │
│     3. 对于无法识别的题目，手动修正或设置默认题型                        │
│                                                                          │
│  Q5: AI补全速度很慢？                                                    │
│  A: 可能原因及解决方案：                                                 │
│     1. API响应慢：更换更快的AI服务                                      │
│     2. 批量任务：系统自动添加1秒间隔防止限流，属正常现象                 │
│     3. 网络问题：检查服务器到AI服务的网络连通性                          │
│                                                                          │
│  Q6: 如何迁移到新服务器？                                                │
│  A: 步骤：                                                               │
│     1. 在旧服务器执行 make backup                                       │
│     2. 复制项目目录和备份文件到新服务器                                  │
│     3. 在新服务器执行 make restore FILE=备份文件                        │
│     4. 执行 make up 启动                                                │
│                                                                          │
│  Q7: 支持哪些浏览器？                                                    │
│  A: 支持所有现代浏览器的最新版本：                                       │
│     - Chrome 90+                                                         │
│     - Firefox 88+                                                        │
│     - Safari 14+                                                         │
│     - Edge 90+                                                           │
│     不支持IE浏览器                                                       │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 11.3 数据库字段速查

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         数据库字段速查表                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  questions 题目表                                                        │
│  ─────────────────────────────────────────────────────────              │
│  id                 TEXT PK      UUID主键                               │
│  category_id        TEXT FK      所属分类                               │
│  type               TEXT         single/multiple/judge/essay           │
│  difficulty         TEXT         easy/medium/hard                      │
│  content            TEXT         题干内容                               │
│  options            TEXT(JSON)   选项 {"A":"xx","B":"xx"...}           │
│  answer             TEXT         答案                                   │
│  answer_status      TEXT         none/ai_pending/ai_generated/confirmed│
│  explanation        TEXT         解析                                   │
│  explanation_status TEXT         同上                                   │
│  tags               TEXT(JSON)   标签数组                               │
│  source             TEXT         来源                                   │
│  created_at         DATETIME     创建时间                               │
│  updated_at         DATETIME     更新时间                               │
│                                                                          │
│  exams 考试表                                                            │
│  ─────────────────────────────────────────────────────────              │
│  id                 TEXT PK      UUID主键                               │
│  title              TEXT         试卷标题                               │
│  config             TEXT(JSON)   组卷配置                               │
│  question_ids       TEXT(JSON)   题目ID列表                             │
│  question_snapshots TEXT(JSON)   题目快照                               │
│  answers            TEXT(JSON)   用户答案                               │
│  score              REAL         得分                                   │
│  total_score        REAL         总分                                   │
│  correct_count      INTEGER      正确数                                 │
│  wrong_count        INTEGER      错误数                                 │
│  time_spent         INTEGER      用时(秒)                               │
│  status             TEXT         ongoing/completed/abandoned           │
│  ai_report          TEXT         AI分析报告                             │
│  created_at         DATETIME     创建时间                               │
│  started_at         DATETIME     开始时间                               │
│  completed_at       DATETIME     完成时间                               │
│                                                                          │
│  状态枚举值速查                                                          │
│  ─────────────────────────────────────────────────────────              │
│  answer_status / explanation_status:                                     │
│    none          无内容（待补全）                                        │
│    ai_pending    AI生成中                                               │
│    ai_generated  AI已生成（待确认）                                      │
│    confirmed     已确认                                                  │
│                                                                          │
│  exam.status:                                                            │
│    ongoing       进行中                                                  │
│    completed     已完成                                                  │
│    abandoned     已放弃                                                  │
│                                                                          │
│  ai_tasks.status:                                                        │
│    pending       待执行                                                  │
│    running       执行中                                                  │
│    paused        已暂停                                                  │
│    completed     已完成                                                  │
│    failed        失败                                                    │
│    cancelled     已取消                                                  │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 11.4 API状态码速查

| 状态码 | 说明 | 处理方式 |
|--------|------|----------|
| 0 | 成功 | 正常处理 |
| 40001 | 参数错误 | 检查请求参数 |
| 40002 | 数据不存在 | 检查ID是否正确 |
| 40003 | 数据已存在 | 检查唯一性约束 |
| 40101 | 未登录/Token无效 | 重新登录 |
| 40102 | Token已过期 | 刷新Token或重新登录 |
| 40103 | 密码错误 | 检查密码 |
| 50001 | 服务器内部错误 | 查看后端日志 |
| 50002 | AI服务调用失败 | 检查AI配置 |
| 50003 | 文件解析失败 | 检查文件格式 |

### 11.5 快捷键

| 页面 | 快捷键 | 功能 |
|------|--------|------|
| 答题页面 | `←` / `→` | 上一题/下一题 |
| 答题页面 | `1-9` | 快速选择选项 |
| 答题页面 | `Enter` | 确认选择/下一题 |
| 答题页面 | `Ctrl+S` | 暂存答案 |
| 题目列表 | `/` | 聚焦搜索框 |
| 全局 | `Esc` | 关闭弹窗 |

---

## 📋 项目计划书总结

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          项目计划书总结                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  📄 文档结构                                                             │
│  ├── 第1部分: 项目概述 + 功能需求                                       │
│  ├── 第2部分: 技术架构 + 数据库设计                                     │
│  ├── 第3部分: API接口设计                                               │
│  ├── 第4部分: 前端页面设计 + AI模块 + 文档解析                          │
│  └── 第5部分: 部署方案 + 开发计划 + 附录                                │
│                                                                          │
│  🎯 核心功能                                                             │
│  ├── 题库管理（CRUD + 多格式导入导出）                                  │
│  ├── AI补全（答案生成 + 解析生成 + 批量任务）                           │
│  ├── 智能组卷（多维度配置 + 多种答题模式）                              │
│  ├── 学习追踪（错题本 + 统计分析）                                      │
│  └── AI报告（错题分析 + 学习建议）                                      │
│                                                                          │
│  🛠️ 技术栈                                                               │
│  ├── 前端: Vue 3 + Vite + Naive UI + Tailwind CSS                       │
│  ├── 后端: FastAPI + SQLAlchemy + SQLite                                │
│  ├── AI: OpenAI Compatible API                                          │
│  └── 部署: Docker Compose                                               │
│                                                                          │
│  📅 开发周期                                                             │
│  └── 预计 18 天完成全部功能                                             │
│                                                                          │
│  🚀 部署方式                                                             │
│  └── docker-compose up -d 一键启动                                      │
│  └── 访问 http://服务器IP:5173                                          │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```
